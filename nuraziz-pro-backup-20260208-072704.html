<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>NURAZIZ PRO</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üí™</text></svg>">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial; background: #0a0e27; color: #fff; min-height: 100vh; }
        .container { max-width: 1000px; margin: 0 auto; padding: 20px; }
        .card { background: #16213e; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
        .input { width: 100%; padding: 10px; margin-bottom: 5px; background: #0a0e27; border: 2px solid #0f3460; color: #00d4ff; border-radius: 6px; }
        .input:focus { outline: none; border-color: #00d4ff; box-shadow: 0 0 10px rgba(0, 212, 255, 0.3); }
        select.input { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%2300d4ff' d='M6 9L1 4h10z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 10px center; padding-right: 35px; }
        select.input option { background: #16213e; color: #00d4ff; padding: 10px; }
        select.input:hover { border-color: #00a8cc; }
        .btn { width: 100%; padding: 10px; margin-bottom: 5px; background: #00d4ff; color: #0a0e27; border: none; border-radius: 6px; font-weight: bold; cursor: pointer; }
        .btn:hover { background: #00a8cc; }
        .btn-sec { background: transparent; border: 2px solid #00d4ff; color: #00d4ff; }
        .btn-sec:hover { background: #00d4ff; color: #0a0e27; }
        .item { background: #0a0e27; border-left: 4px solid #00d4ff; padding: 10px; margin-bottom: 10px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; }
        .header { background: linear-gradient(90deg, #0f3460 0%, #00d4ff 100%); padding: 20px; margin-bottom: 20px; border-radius: 8px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { font-size: 32px; margin: 0; flex: 1; text-align: center; }
        .header h1 { font-size: 24px; margin: 0; flex: 1; text-align: center; line-height: 1.3; }
        @media (max-width: 768px) { .header h1 { font-size: 18px; } }
        .hidden { display: none !important; }
        .sidebar { position: fixed; left: -280px; top: 0; width: 280px; height: 100vh; background: #16213e; border-right: 2px solid #0f3460; padding: 20px; overflow-y: auto; transition: left 0.3s; z-index: 1000; }
        .sidebar.open { left: 0; }
        .overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; z-index: 999; }
        .overlay.show { display: block; }
        .burger { background: #00d4ff; color: #0a0e27; border: none; padding: 10px 15px; border-radius: 6px; cursor: pointer; font-size: 18px; font-weight: bold; }
        .settings-section { background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 15px; margin-bottom: 20px; }
        .settings-section h3 { color: #00d4ff; margin-bottom: 15px; font-size: 18px; border-bottom: 2px solid #0f3460; padding-bottom: 10px; }
        .food-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        @media (max-width: 1024px) { .food-grid { grid-template-columns: 1fr 1fr; } }
        @media (max-width: 768px) { 
            .food-grid { grid-template-columns: 1fr; }
            .stats-grid-3 { grid-template-columns: 1fr !important; }
            .stats-grid-4 { grid-template-columns: 1fr 1fr !important; }
            .weekly-calendar { grid-template-columns: repeat(4, 1fr) !important; }
        }
        @media (max-width: 480px) {
            .stats-grid-4 { grid-template-columns: 1fr !important; }
            .weekly-calendar { grid-template-columns: repeat(3, 1fr) !important; }
        }
        .menu-btn { width: 100%; text-align: left; padding: 12px; background: #0a0e27; border: 2px solid #0f3460; color: #00d4ff; border-radius: 6px; margin-bottom: 10px; cursor: pointer; font-weight: bold; }
        .menu-btn:hover { background: #00d4ff; color: #0a0e27; }
        .food-good { border-left-color: #00ff88; }
        .food-bad { border-left-color: #ff0055; }
        select.input { cursor: pointer; }
        @keyframes blink {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }
    </style>
</head>
<body>
    <div id="login-screen">
        <div style="display: flex; align-items: center; justify-content: center; min-height: 100vh; background: linear-gradient(135deg, #0a0e27 0%, #16213e 100%);">
            <div class="card" style="max-width: 400px;">
                <div id="login-form">
                    <h1 style="text-align: center; margin-bottom: 30px; color: #00d4ff;">NURAZIZ PRO</h1>
                    <form onsubmit="return false;" autocomplete="off">
                        <input type="tel" id="phone" name="phone-login-2024" placeholder="+998" class="input" autocomplete="off" inputmode="numeric" oninput="formatPhoneInput(this)" maxlength="17">
                        <input type="password" id="pass" name="pass-login-2024" placeholder="" class="input" autocomplete="off">
                        <button onclick="login(event)" class="btn">KIRISH</button>
                        <button type="button" onclick="showRegister()" class="btn btn-sec">YANGI AKKAUNT</button>
                        <button type="button" onclick="showAdminLoginDirect()" class="btn" style="background: #ff0055; margin-top: 10px;">üîê ADMIN KIRISH</button>
                    </form>
                </div>
                <div id="register-form" class="hidden">
                    <h2 style="text-align: center; margin-bottom: 20px; color: #00d4ff;">YANGI AKKAUNT</h2>
                    <form onsubmit="return false;" autocomplete="off">
                        <input type="text" id="reg-name" name="name-reg-2024" placeholder="Ismingiz" class="input" autocomplete="off" style="margin-bottom: 15px;">
                        <input type="tel" id="reg-phone" name="reg-phone-2024" placeholder="+998" class="input" autocomplete="off" inputmode="numeric" oninput="formatPhoneInput(this)" maxlength="17">
                        <input type="password" id="reg-pass" name="reg-pass-2024" placeholder="" class="input" autocomplete="off">
                        <input type="password" id="reg-pass2" name="reg-pass2-2024" placeholder="" class="input" autocomplete="off" style="margin-bottom: 15px;">
                        <button onclick="registerUser(event)" class="btn">YARATISH</button>
                        <button type="button" onclick="backToLogin()" class="btn btn-sec">ORQAGA</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <div id="main-screen" class="hidden">
        <div class="header">
            <h1 id="page-title">NURAZIZ</h1>
            <div style="display: flex; gap: 10px;">
                <button class="burger" onclick="toggleSidebar()">‚ò∞</button>
                <button onclick="logout()" style="background: #ff0055; color: #fff; border: none; cursor: pointer; font-weight: bold; padding: 10px 15px; border-radius: 6px;">CHIQISH</button>
            </div>
        </div>

        <div class="overlay" id="overlay" onclick="closeSidebar()"></div>
        <div class="sidebar" id="sidebar">
            <button onclick="closeSidebar()" style="width: 100%; background: #ff0055; color: #fff; border: none; padding: 10px; border-radius: 6px; margin-bottom: 20px; cursor: pointer; font-weight: bold;">‚úï YOPISH</button>
            
            <div style="background: #0a0e27; border: 2px solid #00d4ff; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                <p style="font-size: 18px; color: #00d4ff; font-weight: bold; margin-bottom: 10px;" id="user-name-display">Foydalanuvchi</p>
                <p style="font-size: 12px; color: #aaa; margin-bottom: 10px;" id="user-phone"></p>
                <button onclick="showNameEdit()" style="width: 100%; background: #00d4ff; color: #0a0e27; border: none; padding: 8px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px; margin-bottom: 10px;">‚úèÔ∏è Ismni O'zgartirish</button>
                <button id="admin-menu-btn" onclick="showAdminLogin(); closeSidebar();" style="display: none; width: 100%; background: #ff0055; color: #fff; border: none; padding: 8px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px;">üîê ADMIN PANEL</button>
            </div>
            
            <button class="menu-btn" onclick="switchTab('settings'); closeSidebar();">‚öôÔ∏è SOZLAMALAR</button>
            <button class="menu-btn" onclick="switchTab('schedule'); closeSidebar();">üìÖ KUNLIK JADVAL</button>
            <button class="menu-btn" onclick="switchTab('morning'); closeSidebar();">üåÖ ERTALAB</button>
            <button class="menu-btn" onclick="switchTab('evening'); closeSidebar();">üåô KECHQURUN</button>
            <button class="menu-btn" onclick="switchTab('food'); closeSidebar();">üçé OVQATLANISH</button>
            <button class="menu-btn" onclick="switchTab('goals'); closeSidebar();">üéØ MAQSADLAR</button>
            <button class="menu-btn" onclick="switchTab('insights'); closeSidebar();">ü§ñ AI MASLAHAT</button>
            <button class="menu-btn" onclick="switchTab('chat'); closeSidebar();">üí¨ AI SUHBAT</button>
            <button class="menu-btn" onclick="switchTab('video'); closeSidebar();">üìπ VIDEO MASLAHAT</button>
            <hr style="border: none; border-top: 1px solid #0f3460; margin: 15px 0;">
            <button class="menu-btn" onclick="switchTab('weekly'); closeSidebar();">üìä HAFTALIK</button>
            <button class="menu-btn" onclick="switchTab('stats'); closeSidebar();">üìà STATISTIKA</button>
        </div>

        <div class="container">
            <div id="settings-tab">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">‚öôÔ∏è SOZLAMALAR</h2>
                    
                    <div class="settings-section">
                        <h3>üë§ SHAXSIY MA'LUMOTLAR</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #aaa; font-size: 12px;">Yosh:</label>
                                <input type="number" id="user-age" class="input" placeholder="Yoshingiz" min="10" max="100" onchange="saveSettings()">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 5px; color: #aaa; font-size: 12px;">Vazn (kg):</label>
                                <input type="number" id="user-weight" class="input" placeholder="Vazningiz" min="30" max="200" onchange="saveSettings()">
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>üéØ MAQSAD</h3>
                        <label style="display: block; margin-bottom: 10px; color: #aaa; font-size: 12px;">Maqsadingizni yozing (masalan: Vazn yo'qotish, Mushak qurish, Sog'lom bo'lish...)</label>
                        <textarea id="user-goal" class="input" onchange="saveSettings()" placeholder="Maqsadingizni bu yerga yozing..." style="font-size: 14px; min-height: 80px; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <div class="settings-section">
                        <h3>üí™ MASHQ REJIMI</h3>
                        <label style="display: block; margin-bottom: 10px; color: #aaa; font-size: 12px;">Mashq rejimingizni yozing (masalan: Haftada 3 kun, ertalab 1 soat...)</label>
                        <textarea id="workout-mode" class="input" onchange="saveSettings()" placeholder="Mashq rejimingizni bu yerga yozing..." style="font-size: 14px; min-height: 80px; resize: vertical; font-family: inherit;"></textarea>
                    </div>
                    
                    <div style="padding: 20px; background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); border-radius: 8px; border: 2px solid #00d4ff; margin-top: 20px;">
                        <p style="color: #00d4ff; font-weight: bold; margin-bottom: 15px; font-size: 16px;">üìä JORIY SOZLAMALAR</p>
                        <p id="settings-info" style="color: #fff; line-height: 1.8;"></p>
                    </div>
                </div>
            </div>

            <div id="schedule-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 15px;">üìÖ KUNLIK JADVAL</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <input type="time" id="schedule-time" class="input">
                        <input type="text" id="schedule-task" class="input" placeholder="Vazifa nomi">
                    </div>
                    <button onclick="addSchedule()" class="btn">QO'SHISH</button>
                    <div id="schedule-list" style="margin-top: 15px;"></div>
                </div>
            </div>

            <div id="morning-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 15px;">üåÖ ERTALAB</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <input type="date" id="morning-date" class="input">
                        <input type="text" id="morning-name" class="input" placeholder="Mashq nomi">
                        <input type="number" id="morning-target" class="input" placeholder="Maqsad" min="1">
                    </div>
                    <button onclick="addMorning()" class="btn">QO'SHISH</button>
                    <div id="morning-list" style="margin-top: 15px;"></div>
                </div>
            </div>

            <div id="evening-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 15px;">üåô KECHQURUN</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <input type="date" id="evening-date" class="input">
                        <input type="text" id="evening-name" class="input" placeholder="Mashq nomi">
                        <input type="number" id="evening-weight" class="input" placeholder="Og'irlik (kg)" min="0">
                    </div>
                    <button onclick="addEvening()" class="btn">QO'SHISH</button>
                    <div id="evening-list" style="margin-top: 15px;"></div>
                </div>
            </div>
            <div id="food-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">üçé OVQATLANISH</h2>
                    
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 15px; margin-bottom: 20px;">
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 10px; margin-bottom: 10px;">
                            <input type="text" id="food-name" class="input" placeholder="Ovqat/Ichimlik nomi">
                            <select id="food-meal" class="input" style="font-size: 14px;">
                                <option value="breakfast">üåÖ Nonushta</option>
                                <option value="lunch">‚òÄÔ∏è Tushlik</option>
                                <option value="dinner">üåô Kechki ovqat</option>
                                <option value="snack">üç™ Atishtirishlar</option>
                                <option value="drink">ü•§ Ichimliklar</option>
                            </select>
                            <select id="food-type" class="input" style="font-size: 14px;">
                                <option value="good">‚úÖ Foydali</option>
                                <option value="bad">‚ùå Zararli</option>
                            </select>
                        </div>
                        <button onclick="addFood()" class="btn">QO'SHISH</button>
                    </div>
                    
                    <div class="food-grid">
                        <div class="settings-section">
                            <h3>üåÖ NONUSHTA</h3>
                            <div id="food-breakfast-list"></div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>‚òÄÔ∏è TUSHLIK</h3>
                            <div id="food-lunch-list"></div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>üåô KECHKI OVQAT</h3>
                            <div id="food-dinner-list"></div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>üç™ ATISHTIRISHLAR</h3>
                            <div id="food-snack-list"></div>
                        </div>
                        
                        <div class="settings-section">
                            <h3>ü•§ ICHIMLIKLAR</h3>
                            <div id="food-drink-list"></div>
                        </div>
                    </div>
                    
                    <!-- AI Ovqatlanish Maslahati -->
                    <div style="margin-top: 30px;">
                        <button onclick="generateNutritionPlan()" class="btn" style="background: linear-gradient(90deg, #00d4ff, #00ff88); font-size: 16px; padding: 15px;">
                            üçΩÔ∏è AI OVQATLANISH REJASI
                        </button>
                    </div>
                    
                    <div id="nutrition-plan" class="hidden" style="margin-top: 20px;">
                        <div class="card" style="background: linear-gradient(135deg, #1a2332 0%, #16213e 100%);">
                            <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px; text-align: center;">üçΩÔ∏è SIZNING OVQATLANISH REJANGIZ</h2>
                            <div id="nutrition-content"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="goals-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 15px;">üéØ MAQSADLAR</h2>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px;">
                        <input type="text" id="goal-name" class="input" placeholder="Maqsad nomi">
                        <input type="number" id="goal-target" class="input" placeholder="Maqsad" min="1">
                    </div>
                    <button onclick="addGoal()" class="btn">QO'SHISH</button>
                    <div id="goals-list" style="margin-top: 15px;"></div>
                </div>
            </div>

            <div id="insights-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">ü§ñ AI MASLAHATLAR</h2>
                    <div id="insights-list"></div>
                </div>
            </div>

            <div id="chat-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">üí¨ AI BILAN SUHBAT</h2>
                    
                    <!-- Chat messages -->
                    <div id="chat-messages" style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px; height: 400px; overflow-y: auto;">
                        <div style="text-align: center; color: #aaa; padding: 20px;">
                            <div style="font-size: 48px; margin-bottom: 10px;">ü§ñ</div>
                            <p>Salom! Men sizning universal AI yordamchingizman.</p>
                            <p>Sport, biznes, ta'lim, hayot - har qanday mavzuda yordam beraman!</p>
                        </div>
                    </div>
                    
                    <!-- Quick questions -->
                    <div style="margin-bottom: 15px;">
                        <div style="color: #00d4ff; margin-bottom: 10px; font-weight: bold;">üí° Tez savollar:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <button onclick="askQuickQuestion('Qanday biznes boshlash mumkin?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üíº Biznes</button>
                            <button onclick="askQuickQuestion('Ingliz tilini qanday o\'rganish kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üó£Ô∏è Ingliz tili</button>
                            <button onclick="askQuickQuestion('Erta turishni qanday odat qilish mumkin?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üåÖ Erta turish</button>
                            <button onclick="askQuickQuestion('Pul ishlashning qanday yo\'llari bor?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üí∞ Pul ishlash</button>
                            <button onclick="askQuickQuestion('Dasturlashni qayerdan boshlash kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üíª Dasturlash</button>
                            <button onclick="askQuickQuestion('Qanday ovqat yeyishim kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">ü•ó Ovqatlanish</button>
                            <button onclick="askQuickQuestion('Vaqtni qanday boshqarish kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">‚è∞ Vaqt</button>
                            <button onclick="askQuickQuestion('Muvaffaqiyatga qanday erishish mumkin?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üèÜ Muvaffaqiyat</button>
                        </div>
                    </div>
                    
                    <!-- Chat input -->
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="chat-input" placeholder="Savolingizni yozing..." class="input" style="flex: 1;" onkeypress="if(event.key==='Enter') sendMessage()">
                        <button onclick="sendMessage()" style="background: #00d4ff; color: #0a0e27; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">Yuborish</button>
                    </div>
                </div>
            </div>

            <div id="video-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">üìπ VIDEO MASLAHAT</h2>
                    
                    <p style="color: #aaa; margin-bottom: 20px; line-height: 1.6;">
                        Har qanday mavzuda savol bering - sport, ish, kasb, hayot, hobbi va boshqalar. 
                        AI sizga mos video topib beradi va tushuntiradi!
                    </p>
                    
                    <!-- Tez mavzular -->
                    <div style="margin-bottom: 20px;">
                        <div style="color: #00d4ff; margin-bottom: 10px; font-weight: bold;">üéØ Mashhur Mavzular:</div>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <button onclick="askVideoQuestion('Erta turishim uchun nima qilishim kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">‚è∞ Erta turish</button>
                            <button onclick="askVideoQuestion('Qanday bodybuilding qilishim kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üí™ Bodybuilding</button>
                            <button onclick="askVideoQuestion('Tillochilik qanday organiladi?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üî® Tillochilik</button>
                            <button onclick="askVideoQuestion('Biznes qanday boshlanadi?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üíº Biznes</button>
                            <button onclick="askVideoQuestion('Ingliz tilini qanday organish mumkin?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üó£Ô∏è Ingliz tili</button>
                            <button onclick="askVideoQuestion('Dasturlashni qayerdan boshlash kerak?')" style="background: #0f3460; color: #00d4ff; border: 2px solid #00d4ff; padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px;">üíª Dasturlash</button>
                        </div>
                    </div>
                    
                    <!-- Savol input -->
                    <div style="display: flex; gap: 10px; margin-bottom: 25px;">
                        <input type="text" id="video-question-input" placeholder="Savolingizni yozing... (masalan: Man erta turishim uchun nima qilishim kerak?)" class="input" style="flex: 1;" onkeypress="if(event.key==='Enter') askVideoAdvice()">
                        <button onclick="askVideoAdvice()" style="background: #00d4ff; color: #0a0e27; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold;">So'rash</button>
                    </div>
                    
                    <!-- AI javob va video -->
                    <div id="video-response-section" class="hidden">
                        <!-- AI tushuntirish -->
                        <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 15px;">
                                <div style="font-size: 32px;">ü§ñ</div>
                                <h3 style="color: #00d4ff; margin: 0;">AI Tushuntirish</h3>
                            </div>
                            <div id="video-ai-explanation" style="color: #fff; line-height: 1.8;"></div>
                        </div>
                        
                        <!-- Video player -->
                        <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <div style="font-size: 32px;">üìπ</div>
                                    <h3 style="color: #00d4ff; margin: 0;">Video Ko'rsatma</h3>
                                </div>
                                <button onclick="changeVideo()" style="background: #00d4ff; color: #0a0e27; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 12px;">üîÑ Boshqa Video</button>
                            </div>
                            <div style="position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden; border-radius: 8px; background: #0a0e27;">
                                <iframe id="video-player-iframe" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none;" src="" allowfullscreen></iframe>
                            </div>
                            <div id="video-title" style="color: #aaa; margin-top: 10px; font-size: 14px;"></div>
                        </div>
                        
                        <!-- Qo'shimcha maslahatlar -->
                        <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 12px; padding: 20px;">
                            <h3 style="color: #00d4ff; margin-bottom: 15px;">üí° Qo'shimcha Maslahatlar</h3>
                            <div id="video-additional-tips" style="color: #fff; line-height: 1.8;"></div>
                        </div>
                    </div>
                    
                    <!-- Oxirgi savollar -->
                    <div id="video-history-section" class="hidden" style="background: #1a2332; border: 2px solid #0f3460; border-radius: 12px; padding: 20px; margin-top: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìö Oxirgi Savollar</h3>
                        <div id="video-history-list"></div>
                    </div>
                </div>
            </div>

            <div id="weekly-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">üìä HAFTALIK NATIJALAR</h2>
                    
                    <!-- Haftalik umumiy ma'lumot -->
                    <div class="stats-grid-3" style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #00d4ff;">
                            <div style="font-size: 32px; font-weight: bold; color: #00d4ff;" id="weekly-total">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Jami Mashqlar</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #00ff88;">
                            <div style="font-size: 32px; font-weight: bold; color: #00ff88;" id="weekly-completed">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Bajarildi</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ff0055;">
                            <div style="font-size: 32px; font-weight: bold; color: #ff0055;" id="weekly-percentage">0%</div>
                            <div style="color: #aaa; margin-top: 5px;">Foiz</div>
                        </div>
                    </div>
                    
                    <!-- Kunlik taqvim -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìÖ Oxirgi 7 Kun</h3>
                        <div class="weekly-calendar" id="weekly-calendar" style="display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px;"></div>
                    </div>
                    
                    <!-- Haftalik grafik -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìà Haftalik Grafik</h3>
                        <div id="weekly-chart" style="height: 200px; position: relative;"></div>
                    </div>
                </div>
            </div>

            <div id="stats-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; font-size: 24px;">üìà UMUMIY STATISTIKA</h2>
                    
                    <!-- Umumiy ma'lumot -->
                    <div class="stats-grid-4" style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #00d4ff;">
                            <div style="font-size: 32px; font-weight: bold; color: #00d4ff;" id="total-workouts">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Jami Mashqlar</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #00ff88;">
                            <div style="font-size: 32px; font-weight: bold; color: #00ff88;" id="completed-workouts">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Bajarildi</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ff0055;">
                            <div style="font-size: 32px; font-weight: bold; color: #ff0055;" id="pending-workouts">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Bajarilmadi</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ffa500;">
                            <div style="font-size: 32px; font-weight: bold; color: #ffa500;" id="success-rate">0%</div>
                            <div style="color: #aaa; margin-top: 5px;">Muvaffaqiyat</div>
                        </div>
                    </div>
                    
                    <!-- Oylik statistika -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìÖ Oylik Ma'lumot</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <div style="margin-bottom: 15px;">
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: #aaa;">üåÖ Ertalab:</span>
                                        <span style="color: #00d4ff; font-weight: bold;" id="monthly-morning">0</span>
                                    </div>
                                    <div style="background: #0a0e27; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div id="monthly-morning-bar" style="background: linear-gradient(90deg, #00d4ff, #00ff88); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                                <div>
                                    <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                                        <span style="color: #aaa;">üåô Kechqurun:</span>
                                        <span style="color: #00d4ff; font-weight: bold;" id="monthly-evening">0</span>
                                    </div>
                                    <div style="background: #0a0e27; height: 8px; border-radius: 4px; overflow: hidden;">
                                        <div id="monthly-evening-bar" style="background: linear-gradient(90deg, #ff0055, #ffa500); height: 100%; width: 0%; transition: width 0.5s;"></div>
                                    </div>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <div style="position: relative; width: 150px; height: 150px;">
                                    <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                        <circle cx="50" cy="50" r="40" fill="none" stroke="#0a0e27" stroke-width="10"/>
                                        <circle id="progress-circle" cx="50" cy="50" r="40" fill="none" stroke="#00d4ff" stroke-width="10" stroke-dasharray="251.2" stroke-dashoffset="251.2" style="transition: stroke-dashoffset 0.5s;"/>
                                    </svg>
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                        <div style="font-size: 24px; font-weight: bold; color: #00d4ff;" id="monthly-percentage">0%</div>
                                        <div style="font-size: 12px; color: #aaa;">Bajarildi</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ovqatlanish statistikasi -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üçé Ovqatlanish Statistikasi</h3>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                            <div>
                                <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                                    <span style="color: #00ff88;">‚úÖ Foydali ovqatlar:</span>
                                    <span style="color: #00ff88; font-weight: bold;" id="good-foods-count">0</span>
                                </div>
                                <div style="display: flex; justify-content: space-between;">
                                    <span style="color: #ff0055;">‚ùå Zararli ovqatlar:</span>
                                    <span style="color: #ff0055; font-weight: bold;" id="bad-foods-count">0</span>
                                </div>
                            </div>
                            <div style="display: flex; align-items: center; justify-content: center;">
                                <div style="position: relative; width: 120px; height: 120px;">
                                    <svg viewBox="0 0 100 100" style="transform: rotate(-90deg);">
                                        <circle cx="50" cy="50" r="35" fill="none" stroke="#ff0055" stroke-width="12" stroke-dasharray="219.8" stroke-dashoffset="0"/>
                                        <circle id="food-circle" cx="50" cy="50" r="35" fill="none" stroke="#00ff88" stroke-width="12" stroke-dasharray="219.8" stroke-dashoffset="219.8" style="transition: stroke-dashoffset 0.5s;"/>
                                    </svg>
                                    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center;">
                                        <div style="font-size: 20px; font-weight: bold; color: #00ff88;" id="food-percentage">0%</div>
                                        <div style="font-size: 10px; color: #aaa;">Foydali</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Yillik grafik -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìä Yillik Grafik (Oxirgi 12 Oy)</h3>
                        <div id="yearly-chart" style="height: 250px; position: relative;"></div>
                    </div>
                </div>
            </div>

            <div id="admin-tab" class="hidden">
                <div class="card">
                    <h2 style="color: #ff0055; margin-bottom: 20px; font-size: 24px;">üîê ADMIN PANEL</h2>
                    
                    <!-- Admin statistika -->
                    <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div style="background: linear-gradient(135deg, #ff0055 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ff0055;">
                            <div style="font-size: 32px; font-weight: bold; color: #fff;" id="admin-total-users">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Jami Foydalanuvchilar</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffa500 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ffa500;">
                            <div style="font-size: 32px; font-weight: bold; color: #fff;" id="admin-pending-users">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Kutayotganlar</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #00ff88 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #00ff88;">
                            <div style="font-size: 32px; font-weight: bold; color: #fff;" id="admin-approved-users">0</div>
                            <div style="color: #aaa; margin-top: 5px;">Tasdiqlangan</div>
                        </div>
                    </div>
                    
                    <!-- Oylik statistika -->
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 25px;">
                        <div style="background: linear-gradient(135deg, #ff0055 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ff0055;">
                            <div style="font-size: 32px; font-weight: bold; color: #fff;" id="admin-expired-users">0</div>
                            <div style="color: #aaa; margin-top: 5px;">üîî Oylik Tugagan</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffa500 0%, #16213e 100%); padding: 20px; border-radius: 8px; text-align: center; border: 2px solid #ffa500;">
                            <div style="font-size: 32px; font-weight: bold; color: #fff;" id="admin-expiring-users">0</div>
                            <div style="color: #aaa; margin-top: 5px;">‚ö†Ô∏è 5 Kun Ichida Tugaydi</div>
                        </div>
                    </div>
                    
                    <!-- Foydalanuvchilar ro'yxati -->
                    <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 12px; padding: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üë• Foydalanuvchilar Ro'yxati</h3>
                        <div id="admin-users-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Admin Login Modal -->
    <div id="admin-login-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000; display: flex; align-items: center; justify-content: center;">
        <div style="background: #16213e; border: 2px solid #ff0055; border-radius: 12px; padding: 30px; max-width: 400px; width: 90%;">
            <h2 style="color: #ff0055; margin-bottom: 20px; text-align: center;">üîê ADMIN KIRISH</h2>
            <input type="password" id="admin-password-input" name="admin-pass-new" placeholder="Admin parolini kiriting" class="input" style="margin-bottom: 15px;" autocomplete="new-password" onkeypress="if(event.key==='Enter') checkAdminPassword()">
            <button onclick="checkAdminPassword()" class="btn" style="background: #ff0055;">KIRISH</button>
            <button onclick="closeAdminLogin()" class="btn btn-sec">BEKOR QILISH</button>
        </div>
    </div>
    
    <!-- AI Chat Modal -->
    <div id="ai-chat-modal" class="hidden" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; align-items: center; justify-content: center; padding: 20px;">
        <div style="background: #16213e; border: 2px solid #00d4ff; border-radius: 12px; width: 100%; max-width: 800px; height: 90vh; display: flex; flex-direction: column;">
            <!-- Header -->
            <div style="padding: 20px; border-bottom: 2px solid #0f3460; display: flex; justify-content: space-between; align-items: center;">
                <h2 style="color: #00d4ff; margin: 0; font-size: 20px;">ü§ñ AI MAQSAD MASLAHAT</h2>
                <button onclick="closeAIChat()" style="background: #ff0055; color: #fff; border: none; padding: 8px 15px; border-radius: 6px; cursor: pointer; font-weight: bold;">
                    ‚úï CHIQISH
                </button>
            </div>
            
            <!-- User Info -->
            <div id="ai-chat-user-info" style="padding: 15px; background: #0a0e27; border-bottom: 2px solid #0f3460; font-size: 13px; color: #aaa;"></div>
            
            <!-- Chat Messages -->
            <div id="ai-chat-messages" style="flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px;">
                <div style="text-align: center; color: #aaa; padding: 20px;">
                    <p style="font-size: 16px; margin-bottom: 10px;">üëã Salom! Men sizning shaxsiy AI murabbiyingizman.</p>
                    <p style="font-size: 14px;">Maqsadingiz, ovqatlanish, mashq, supplement va boshqa savollaringizga javob beraman.</p>
                </div>
            </div>
            
            <!-- Input Area -->
            <div style="padding: 20px; border-top: 2px solid #0f3460; background: #0a0e27;">
                <div style="display: flex; gap: 10px;">
                    <input type="text" id="ai-chat-input" placeholder="Savolingizni yozing..." class="input" style="flex: 1; font-size: 16px; padding: 15px;" onkeypress="if(event.key==='Enter') sendAIMessage()">
                    <button onclick="sendAIMessage()" class="btn" style="background: linear-gradient(90deg, #00d4ff, #00ff88); padding: 15px 30px; font-size: 16px;">
                        üì§ YUBORISH
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        const ADMIN_PASSWORD = '963';
        let isAdmin = false;
        let aiChatHistory = [];
        
        const db = {
            user: () => localStorage.getItem('nuraziz_user'),
            setUser: (u) => localStorage.setItem('nuraziz_user', u),
            clear: () => { localStorage.removeItem('nuraziz_user'); }
        };

        let userData = null;

        async function loadUserData() {
            const phone = db.user();
            if (!phone) return null;
            
            try {
                // Try MongoDB first
                const response = await fetch('/api/get-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const result = await response.json();
                if (result.success && result.user) {
                    userData = result.user;
                    if (!userData.settings) {
                        userData.settings = { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' };
                    }
                    if (!userData.foods) userData.foods = [];
                    return userData;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            if (localData[phone]) {
                userData = localData[phone];
                if (!userData.settings) {
                    userData.settings = { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' };
                }
                if (!userData.foods) userData.foods = [];
                return userData;
            }
            
            return null;
        }

        async function saveUserData() {
            if (!userData) return;
            try {
                // Try MongoDB first
                await fetch('/api/save-user', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(userData)
                });
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Always save to LocalStorage as backup
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            localData[userData.phone] = userData;
            localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
        }

        function formatPhone(input) {
            if (!input) return;
            let val = input.value.replace(/\D/g, '');
            if (val.length > 12) val = val.slice(0, 12);
            
            let formatted = '';
            if (val.length > 0) formatted = '+' + val.slice(0, 3);
            if (val.length > 3) formatted += ' ' + val.slice(3, 5);
            if (val.length > 5) formatted += ' ' + val.slice(5, 8);
            if (val.length > 8) formatted += ' ' + val.slice(8, 10);
            if (val.length > 10) formatted += ' ' + val.slice(10, 12);
            
            input.value = formatted;
        }

        function getCleanPhone(phone) {
            // Remove all non-digits and +998 prefix
            let clean = phone.replace(/\D/g, '');
            // If doesn't start with 998, add it
            if (!clean.startsWith('998')) {
                clean = '998' + clean;
            }
            return clean;
        }
        
        function formatPhoneInput(input) {
            // Remove all non-digits
            let digits = input.value.replace(/\D/g, '');
            
            // Remove 998 prefix if user typed it
            if (digits.startsWith('998')) {
                digits = digits.substring(3);
            }
            
            // Limit to exactly 9 digits
            digits = digits.substring(0, 9);
            
            // Format: +998 XX XXX XXXX
            if (digits.length === 0) {
                input.value = '';
            } else if (digits.length <= 2) {
                input.value = '+998 ' + digits;
            } else if (digits.length <= 5) {
                input.value = '+998 ' + digits.substring(0, 2) + ' ' + digits.substring(2);
            } else {
                input.value = '+998 ' + digits.substring(0, 2) + ' ' + digits.substring(2, 5) + ' ' + digits.substring(5);
            }
        }

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('open');
            document.getElementById('overlay').classList.toggle('show');
        }

        function closeSidebar() {
            document.getElementById('sidebar').classList.remove('open');
            document.getElementById('overlay').classList.remove('show');
        }

        function showNameEdit() {
            const currentName = userData.name || 'Foydalanuvchi';
            const newName = prompt('Yangi ismingizni kiriting:', currentName);
            if (newName && newName.trim() !== '' && newName.trim() !== currentName) {
                userData.name = newName.trim();
                saveUserData();
                updateUserDisplay();
                // Update current page title
                const currentTab = document.querySelector('[id$="-tab"]:not(.hidden)').id.replace('-tab', '');
                updatePageTitle(currentTab);
            }
        }

        function updateUserDisplay() {
            const userName = userData.name || 'Foydalanuvchi';
            document.getElementById('user-name-display').textContent = userName;
            document.getElementById('user-phone').textContent = db.user();
        }
        async function login(event) {
            if (event) event.preventDefault();
            
            const phoneInput = document.getElementById('phone').value.trim();
            const p = getCleanPhone(phoneInput);
            const pw = document.getElementById('pass').value.trim();
            
            console.log('Login clicked!');
            console.log('Login - Phone input:', phoneInput);
            console.log('Login - Clean phone:', p);
            console.log('Login - Password:', pw);
            
            if (!p || !pw) { alert('Hammasini to\'ldiring'); return; }
            
            // Check if admin login
            if (p === '998918235858' && pw === ADMIN_PASSWORD) {
                console.log('Admin login detected');
                isAdmin = true;
                db.setUser(p);
                userData = {
                    name: 'Admin',
                    phone: p,
                    pass: pw,
                    approved: true,
                    schedule: {},
                    morning: [],
                    evening: [],
                    goals: [],
                    foods: [],
                    settings: { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' }
                };
                show();
                return;
            }
            
            try {
                // Try MongoDB first
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: p, pass: pw })
                });
                const result = await response.json();
                
                if (result.success) {
                    console.log('MongoDB login successful');
                    
                    // Check if user is approved
                    if (result.user.approved === false) {
                        alert('Sizning akkountingiz hali tasdiqlanmagan. Admin tasdig\'ini kuting.');
                        return;
                    }
                    
                    db.setUser(p);
                    userData = result.user;
                    if (!userData.settings) {
                        userData.settings = { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' };
                    }
                    if (!userData.foods) userData.foods = [];
                    show();
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            console.log('LocalStorage data:', localData);
            console.log('Looking for phone:', p);
            console.log('User data:', localData[p]);
            
            if (!localData[p]) {
                console.log('User not found!');
                alert('Noto\'g\'ri telefon yoki kod');
                return;
            }
            
            if (localData[p].pass !== pw) {
                console.log('Password mismatch! Stored:', localData[p].pass, 'Entered:', pw);
                alert('Noto\'g\'ri telefon yoki kod');
                return;
            }
            
            // Check if user is approved
            if (localData[p].approved === false) {
                alert('Sizning akkountingiz hali tasdiqlanmagan. Admin tasdig\'ini kuting.');
                return;
            }
            
            console.log('Login successful!');
            db.setUser(p);
            userData = localData[p];
            if (!userData.settings) {
                userData.settings = { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' };
            }
            if (!userData.foods) userData.foods = [];
            
            // Check subscription
            checkSubscription();
            show();
        }
        
        function checkSubscription() {
            if (!userData || !userData.subscriptionExpiry) {
                // Old users without subscription - add 30 days from now
                const now = new Date();
                const expiry = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000);
                userData.subscriptionDate = now;
                userData.subscriptionExpiry = expiry;
                userData.subscriptionActive = true;
                saveUserData();
                return;
            }
            
            const now = new Date();
            const expiry = new Date(userData.subscriptionExpiry);
            const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
            
            console.log('Subscription check:', {
                now: now,
                expiry: expiry,
                daysLeft: daysLeft
            });
            
            if (daysLeft <= 0) {
                // Subscription expired
                alert(`‚ùå OYLIGINGIZ TUGADI!\n\n${userData.name}, oyligingiz ${Math.abs(daysLeft)} kun oldin tugagan.\n\nüìû 918335005 raqamiga qo'ng'iroq qiling va oyligingizni to'lang!`);
                userData.subscriptionActive = false;
                saveUserData();
            } else if (daysLeft <= 5) {
                // Subscription expiring soon
                alert(`‚ö†Ô∏è OGOHLANTIRISH!\n\n${userData.name}, oyligingiz ${daysLeft} kun ichida tugaydi!\n\nüìû 918335005 raqamiga qo'ng'iroq qiling.`);
            } else {
                // Subscription active
                console.log(`‚úÖ Subscription active: ${daysLeft} days left`);
            }
        }

        function showRegister() {
            // Clear all inputs
            document.getElementById('reg-name').value = '';
            document.getElementById('reg-phone').value = '';
            document.getElementById('reg-pass').value = '';
            document.getElementById('reg-pass2').value = '';
            
            document.getElementById('login-form').classList.add('hidden');
            document.getElementById('register-form').classList.remove('hidden');
        }

        function backToLogin() {
            // Clear all inputs
            document.getElementById('phone').value = '';
            document.getElementById('pass').value = '';
            
            document.getElementById('register-form').classList.add('hidden');
            document.getElementById('login-form').classList.remove('hidden');
        }

        async function registerUser(event) {
            if (event) event.preventDefault();
            
            const name = document.getElementById('reg-name').value.trim();
            const phoneInput = document.getElementById('reg-phone').value.trim();
            const p = getCleanPhone(phoneInput);
            const pw = document.getElementById('reg-pass').value.trim();
            const pw2 = document.getElementById('reg-pass2').value.trim();
            
            console.log('Register clicked!');
            console.log('Register - Name:', name);
            console.log('Register - Phone input:', phoneInput);
            console.log('Register - Clean phone:', p);
            console.log('Register - Password:', pw);
            
            if (!name || !p || !pw || !pw2) { alert('Hammasini to\'ldiring'); return; }
            if (pw.length < 4 || pw.length > 6) { alert('Kod 4-6 raqam bo\'lishi kerak'); return; }
            if (pw !== pw2) { alert('Kodlar mos emas'); return; }
            
            try {
                // Try MongoDB first
                const response = await fetch('/api/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone: p, pass: pw, name: name })
                });
                const result = await response.json();
                
                if (result.success) {
                    console.log('MongoDB registration successful');
                    
                    // Also save to LocalStorage as backup
                    const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
                    const now = new Date();
                    const subscriptionExpiry = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days
                    
                    localData[p] = {
                        name: name,
                        phone: p,
                        pass: pw,
                        approved: false, // Yangi foydalanuvchi admin tasdig'ini kutadi
                        createdAt: now,
                        subscriptionDate: now,
                        subscriptionExpiry: subscriptionExpiry,
                        subscriptionActive: true,
                        schedule: {},
                        morning: [],
                        evening: [],
                        goals: [],
                        foods: [],
                        settings: { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' }
                    };
                    localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                    console.log('Also saved to LocalStorage as backup');
                    
                    alert('Akkaunt yaratildi! Admin tasdig\'ini kuting.');
                    backToLogin();
                    return;
                } else if (result.error === 'exists') {
                    alert('Bu telefon allaqachon ro\'yxatdan o\'tgan');
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            console.log('Current LocalStorage data:', localData);
            
            if (localData[p]) {
                alert('Bu telefon allaqachon ro\'yxatdan o\'tgan');
                return;
            }
            
            const now = new Date();
            const subscriptionExpiry = new Date(now.getTime() + 30 * 24 * 60 * 60 * 1000); // 30 days
            
            localData[p] = {
                name: name,
                phone: p,
                pass: pw,
                approved: false, // Yangi foydalanuvchi admin tasdig'ini kutadi
                createdAt: now,
                subscriptionDate: now,
                subscriptionExpiry: subscriptionExpiry,
                subscriptionActive: true,
                schedule: {},
                morning: [],
                evening: [],
                goals: [],
                foods: [],
                settings: { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' }
            };
            
            localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
            console.log('Saved to LocalStorage:', localData[p]);
            alert('Akkaunt yaratildi! Admin tasdig\'ini kuting.');
            backToLogin();
        }

        function logout() {
            if (confirm('Chiqish?')) { 
                db.clear();
                userData = null;
                location.reload(); 
            }
        }
        function switchTab(tab) {
            document.querySelectorAll('[id$="-tab"]').forEach(el => el.classList.add('hidden'));
            document.getElementById(tab + '-tab').classList.remove('hidden');
            updatePageTitle(tab);
            update();
        }

        function updatePageTitle(tab) {
            const userName = userData.name || 'Foydalanuvchi';
            const titles = {
                'settings': `${userName}ning Sozlamalari`,
                'schedule': `${userName}ning Kunlik Rejalari`,
                'morning': `${userName}ning Ertalabki Mashqlari`,
                'evening': `${userName}ning Kechqurun Mashqlari`,
                'food': `${userName}ning Ovqatlanish Rejasi`,
                'goals': `${userName}ning Maqsadlari`,
                'insights': `${userName}ga AI Maslahatlar`,
                'chat': `${userName} va AI Suhbat`,
                'video': `${userName}ga Video Maslahat`,
                'weekly': `${userName}ning Haftalik Natijalari`,
                'stats': `${userName}ning Statistikasi`,
                'admin': `Admin Panel - Foydalanuvchilar`
            };
            document.getElementById('page-title').textContent = titles[tab] || 'NURAZIZ';
        }

        async function saveSettings() {
            userData.settings = {
                age: parseInt(document.getElementById('user-age').value) || 0,
                weight: parseInt(document.getElementById('user-weight').value) || 0,
                goal: document.getElementById('user-goal').value.trim() || '',
                workoutMode: document.getElementById('workout-mode').value.trim() || ''
            };
            await saveUserData();
            updateSettingsInfo();
        }
        
        // AI Goal Description Generator - Opens Chat Modal
        function generateGoalDescription() {
            const goal = document.getElementById('user-goal').value.trim();
            
            if (!goal) {
                alert('Iltimos, avval maqsadingizni yozing!');
                return;
            }
            
            // Open AI Chat Modal
            openAIGoalChat();
        }
        
        // AI Workout Plan Generator
        function generateWorkoutPlan() {
            const workoutMode = document.getElementById('workout-mode').value.trim();
            
            if (!workoutMode) {
                alert('Iltimos, avval mashq rejimingizni yozing!');
                return;
            }
            
            const q = workoutMode.toLowerCase();
            let plan = '';
            
            // Analyze user's workout plan
            const isDaily = q.includes('har kuni') || q.includes('kuniga') || q.includes('daily') || q.includes('kun');
            const is3Times = q.includes('3') || q.includes('uch');
            const is4Times = q.includes('4') || q.includes('tort');
            const is5Times = q.includes('5') || q.includes('besh');
            const isMorning = q.includes('ertalab') || q.includes('morning') || q.includes('tong');
            const isEvening = q.includes('kechqurun') || q.includes('evening') || q.includes('kech');
            const hasCardio = q.includes('yugur') || q.includes('kardio') || q.includes('cardio') || q.includes('yur');
            const hasStrength = q.includes('og\'ir') || q.includes('vazn') || q.includes('strength') || q.includes('kuch');
            const hasGym = q.includes('zal') || q.includes('gym') || q.includes('fitnes');
            const hasHome = q.includes('uyda') || q.includes('home');
            
            plan = `
                <h3 style="color: #ffa500; margin-bottom: 15px;">üí™ SIZNING MASHQ REJIMINGIZ</h3>
                <div style="background: #0a0e27; padding: 15px; border-radius: 8px; border: 2px solid #ffa500; margin-bottom: 15px;">
                    <p style="color: #00d4ff; font-weight: bold; margin-bottom: 10px;">üìù Siz yozgan:</p>
                    <p style="color: #fff; font-size: 16px; line-height: 1.6;">"${workoutMode}"</p>
                </div>
                
                <h4 style="color: #00d4ff; margin-bottom: 10px;">ü§ñ AI TAHLIL VA MASLAHATLAR:</h4>
            `;
            
            // Frequency analysis
            if (isDaily || is5Times) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #00ff88;">
                        <p style="color: #00ff88; font-weight: bold;">‚úÖ AJOYIB CHASTOTA!</p>
                        <p>Har kuni yoki haftada 5+ kun mashq qilish - bu juda yaxshi! Lekin esda tuting:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üí™ Har mushak guruhiga 48 soat dam bering</li>
                            <li>üîÑ Turli mashqlarni almashtiring (kardio, kuch, stretching)</li>
                            <li>üò¥ Yetarli uxlang (7-8 soat)</li>
                            <li>üçé To'g'ri ovqatlaning (protein, uglevod, vitamin)</li>
                        </ul>
                    </div>
                `;
            } else if (is3Times || is4Times) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #00d4ff;">
                        <p style="color: #00d4ff; font-weight: bold;">üëç YAXSHI CHASTOTA!</p>
                        <p>Haftada 3-4 kun - bu optimal! Tavsiyalar:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üèãÔ∏è Har mashqni maksimal foydalaning</li>
                            <li>üî• Intensivlikni oshiring</li>
                            <li>üìà Progressiv overload qo'llang (har hafta vazn oshiring)</li>
                            <li>üéØ Aniq maqsad qo'ying har mashq uchun</li>
                        </ul>
                    </div>
                `;
            } else {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0; border-left: 4px solid #ffa500;">
                        <p style="color: #ffa500; font-weight: bold;">‚ö†Ô∏è CHASTOTANI OSHIRING!</p>
                        <p>Yaxshi natija uchun haftada kamida 3 kun mashq qiling:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üìÖ Haftada 3-5 kun optimal</li>
                            <li>‚è∞ Har mashq 30-60 daqiqa</li>
                            <li>üîÑ Muntazamlik muhim!</li>
                        </ul>
                    </div>
                `;
            }
            
            // Time of day analysis
            if (isMorning) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üåÖ ERTALABKI MASHQ</p>
                        <p><strong>Afzalliklari:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>‚ö° Energiya va kayfiyat oshadi</li>
                            <li>üî• Metabolizm tezlashadi</li>
                            <li>üéØ Kun davomida fokus yaxshiroq</li>
                            <li>üò¥ Kechqurun yaxshi uxlaysiz</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>üí° Maslahat:</strong> Mashqdan oldin yengil nonushta qiling (banan, tuxum, yog'oq)</p>
                    </div>
                `;
            }
            
            if (isEvening) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üåô KECHKI MASHQ</p>
                        <p><strong>Afzalliklari:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>üí™ Mushaklar issiq, kuch ko'proq</li>
                            <li>üèãÔ∏è Og'ir vazn ko'tarish oson</li>
                            <li>üòå Stressni kamaytiradi</li>
                            <li>üçΩÔ∏è Kun davomida ovqatlangan bo'lasiz</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>üí° Maslahat:</strong> Uxlashdan 2-3 soat oldin tugating, keyin protein iching</p>
                    </div>
                `;
            }
            
            // Workout type analysis
            if (hasCardio) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üèÉ KARDIO MASHQLAR</p>
                        <p><strong>Tavsiya qilinadigan mashqlar:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Yugurish:</strong> 30-45 daqiqa, o'rtacha tezlik</li>
                            <li><strong>HIIT:</strong> 20 daqiqa (30s sprint + 30s dam)</li>
                            <li><strong>Velosiped:</strong> 40-60 daqiqa</li>
                            <li><strong>Suzish:</strong> 30-45 daqiqa</li>
                            <li><strong>Jumping Jacks:</strong> 3√ó50 marta</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>üéØ Maqsad:</strong> Yurak-qon tomir tizimini mustahkamlash, yog' yoqish</p>
                    </div>
                `;
            }
            
            if (hasStrength) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üèãÔ∏è KUCH MASHQLARI</p>
                        <p><strong>Asosiy mashqlar:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Squats:</strong> 4√ó8-12 (oyoqlar, dumba)</li>
                            <li><strong>Deadlift:</strong> 4√ó6-8 (orqa, oyoqlar)</li>
                            <li><strong>Bench Press:</strong> 4√ó8-12 (ko'krak, yelka)</li>
                            <li><strong>Pull-ups:</strong> 4√ó8-12 (orqa, biceps)</li>
                            <li><strong>Shoulder Press:</strong> 4√ó8-12 (yelka)</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>üí° Maslahat:</strong> Progressiv overload - har hafta vazn yoki takror oshiring!</p>
                    </div>
                `;
            }
            
            // Location analysis
            if (hasGym) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üè¢ ZAL MASHQLARI</p>
                        <p><strong>Zaldan maksimal foydalaning:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li>üèãÔ∏è Erkin vaznlar (barbell, dumbbell) - asosiy</li>
                            <li>üîß Trenajorlar - qo'shimcha</li>
                            <li>üë®‚Äçüè´ Trener bilan ishlang (birinchi 1-2 oy)</li>
                            <li>üìù Mashq jurnali yuritng</li>
                            <li>ü§ù Mashq sherigi toping</li>
                        </ul>
                    </div>
                `;
            }
            
            if (hasHome) {
                plan += `
                    <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 10px 0;">
                        <p style="color: #00d4ff; font-weight: bold;">üè† UYDA MASHQLAR</p>
                        <p><strong>Asbobsiz mashqlar:</strong></p>
                        <ul style="margin-left: 20px; margin-top: 5px;">
                            <li><strong>Push-ups:</strong> 4√ó15-20 (ko'krak, yelka, triceps)</li>
                            <li><strong>Squats:</strong> 4√ó20-30 (oyoqlar, dumba)</li>
                            <li><strong>Lunges:</strong> 3√ó15 har oyoq (oyoqlar)</li>
                            <li><strong>Plank:</strong> 3√ó60s (qorin, orqa)</li>
                            <li><strong>Burpees:</strong> 3√ó15 (butun tana)</li>
                        </ul>
                        <p style="margin-top: 10px;"><strong>üí° Maslahat:</strong> Dumbbell yoki rezinka sotib oling - ko'proq mashqlar!</p>
                    </div>
                `;
            }
            
            // General tips
            plan += `
                <div style="background: #0a0e27; padding: 15px; border-radius: 8px; margin: 15px 0; border: 2px solid #00ff88;">
                    <p style="color: #00ff88; font-weight: bold; margin-bottom: 10px;">‚úÖ UMUMIY TAVSIYALAR</p>
                    <ul style="margin-left: 20px;">
                        <li>üî• <strong>Isitish:</strong> Har mashqdan oldin 5-10 daqiqa (yugurish, jumping jacks)</li>
                        <li>üí™ <strong>To'g'ri texnika:</strong> To'g'ri texnika > og'ir vazn</li>
                        <li>üìà <strong>Progressiv overload:</strong> Har hafta vazn yoki takror oshiring</li>
                        <li>üò¥ <strong>Dam olish:</strong> Har mushak guruhiga 48 soat dam</li>
                        <li>üçé <strong>Ovqatlanish:</strong> Protein (2g/kg), uglevod, vitamin</li>
                        <li>üíß <strong>Suv:</strong> Kuniga 2.5-3 litr</li>
                        <li>üò¥ <strong>Uyqu:</strong> 7-8 soat (mushak uyquda o'sadi)</li>
                        <li>üßä <strong>Sovutish:</strong> Mashqdan keyin 5-10 daqiqa stretching</li>
                    </ul>
                </div>
                
                <div style="background: #16213e; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffa500;">
                    <p style="color: #ffa500; font-weight: bold; margin-bottom: 10px;">‚ö†Ô∏è MUHIM ESLATMALAR</p>
                    <ul style="margin-left: 20px;">
                        <li>‚ùå <strong>Overtraining qilmang!</strong> Mushak dam olishda o'sadi</li>
                        <li>‚ùå <strong>Bir xil mashqni takrorlamang!</strong> Har 4-6 haftada o'zgartiring</li>
                        <li>‚ùå <strong>Isitishni o'tkazmang!</strong> Jarohatlangan bo'lishingiz mumkin</li>
                        <li>‚úÖ <strong>Agar og'riq bo'lsa, to'xtang!</strong> Og'riq ‚â† natija</li>
                        <li>‚úÖ <strong>Sabr qiling!</strong> Natija 4-8 haftada ko'rinadi</li>
                    </ul>
                </div>
            `;
            
            document.getElementById('workout-plan-description').innerHTML = plan;
            document.getElementById('workout-plan-description').classList.remove('hidden');
            document.getElementById('workout-plan-description').scrollIntoView({ behavior: 'smooth' });
        }
        
        function updateSettingsInfo() {
            const s = userData.settings;
            
            let info = '';
            if (s.age) info += `<strong>Yosh:</strong> ${s.age}<br>`;
            if (s.weight) info += `<strong>Vazn:</strong> ${s.weight} kg<br>`;
            if (s.goal) info += `<strong>Maqsad:</strong> ${s.goal}<br>`;
            if (s.workoutMode) info += `<strong>Mashq rejimi:</strong> ${s.workoutMode}<br>`;
            
            // Add subscription info
            if (userData.createdAt || userData.subscriptionExpiry) {
                info += '<br><div style="border-top: 2px solid #0f3460; padding-top: 15px; margin-top: 15px;">';
                info += '<p style="color: #00d4ff; font-weight: bold; margin-bottom: 10px;">üí∞ OYLIK TO\'LOV</p>';
                
                // Registration date
                if (userData.createdAt) {
                    const regDate = new Date(userData.createdAt);
                    info += `<strong>üìÖ Ro'yxatdan o'tgan:</strong> ${regDate.toLocaleDateString('uz-UZ')}<br>`;
                }
                
                // Subscription expiry
                if (userData.subscriptionExpiry) {
                    const now = new Date();
                    const expiry = new Date(userData.subscriptionExpiry);
                    const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
                    
                    info += `<strong>üìÜ Oylik tugash sanasi:</strong> ${expiry.toLocaleDateString('uz-UZ')}<br>`;
                    
                    if (daysLeft <= 0) {
                        info += `<strong style="color: #ff0055;">üîî Status:</strong> <span style="color: #ff0055; font-weight: bold;">Oylik ${Math.abs(daysLeft)} kun oldin tugagan!</span><br>`;
                        info += `<strong style="color: #ff0055;">üìû Telefon:</strong> <span style="color: #ff0055;">918335005 ga qo'ng'iroq qiling!</span>`;
                    } else if (daysLeft <= 5) {
                        info += `<strong style="color: #ffa500;">‚ö†Ô∏è Status:</strong> <span style="color: #ffa500; font-weight: bold;">Oylik ${daysLeft} kun ichida tugaydi!</span><br>`;
                        info += `<strong style="color: #ffa500;">üìû Telefon:</strong> <span style="color: #ffa500;">918335005 ga qo'ng'iroq qiling!</span>`;
                    } else {
                        info += `<strong style="color: #00ff88;">‚úÖ Status:</strong> <span style="color: #00ff88; font-weight: bold;">Oylik faol (${daysLeft} kun qoldi)</span>`;
                    }
                }
                
                info += '</div>';
            }
            
            document.getElementById('settings-info').innerHTML = info || 'Sozlamalar to\'ldirilmagan';
        }

        async function addSchedule() {
            const time = document.getElementById('schedule-time').value;
            const task = document.getElementById('schedule-task').value.trim();
            if (!time || !task) { alert('Hammasini to\'ldiring'); return; }
            
            if (!userData.schedule) userData.schedule = {};
            const today = new Date().toISOString().split('T')[0];
            if (!userData.schedule[today]) userData.schedule[today] = [];
            userData.schedule[today].push({ id: Date.now(), time, name: task, completed: false });
            
            await saveUserData();
            document.getElementById('schedule-time').value = '';
            document.getElementById('schedule-task').value = '';
            update();
        }

        async function deleteSchedule(id) {
            const today = new Date().toISOString().split('T')[0];
            userData.schedule[today] = userData.schedule[today].filter(t => t.id !== id);
            await saveUserData();
            update();
        }

        async function toggleScheduleComplete(id, isCompleted) {
            const today = new Date().toISOString().split('T')[0];
            const task = userData.schedule[today].find(t => t.id === id);
            if (task) {
                task.completed = isCompleted;
                await saveUserData();
                update();
            }
        }

        async function editSchedule(id) {
            const today = new Date().toISOString().split('T')[0];
            const task = userData.schedule[today].find(t => t.id === id);
            if (!task) return;
            
            const newTime = prompt('Yangi vaqt (HH:MM):', task.time);
            if (!newTime) return;
            
            const newName = prompt('Yangi vazifa nomi:', task.name);
            if (!newName) return;
            
            task.time = newTime;
            task.name = newName;
            
            await saveUserData();
            update();
        }

        async function addMorning() {
            const date = document.getElementById('morning-date').value;
            const name = document.getElementById('morning-name').value.trim();
            const target = parseInt(document.getElementById('morning-target').value) || 0;
            if (!date || !name || !target) { alert('Hammasini to\'ldiring'); return; }
            
            if (!userData.morning) userData.morning = [];
            userData.morning.push({ id: Date.now(), name, target, actual: 0, status: 'pending', date: date });
            
            await saveUserData();
            document.getElementById('morning-date').value = '';
            document.getElementById('morning-name').value = '';
            document.getElementById('morning-target').value = '';
            update();
        }

        async function editMorning(id) {
            const m = userData.morning.find(x => x.id === id);
            if (!m) return;
            const actual = prompt('Qilgan:', m.actual);
            if (actual !== null) {
                m.actual = parseInt(actual) || 0;
                m.status = m.actual >= m.target ? 'completed' : m.actual > 0 ? 'partial' : 'pending';
                await saveUserData();
                update();
            }
        }

        async function deleteMorning(id) {
            userData.morning = userData.morning.filter(x => x.id !== id);
            await saveUserData();
            update();
        }
        async function addEvening() {
            const date = document.getElementById('evening-date').value;
            const name = document.getElementById('evening-name').value.trim();
            const weight = parseInt(document.getElementById('evening-weight').value) || 0;
            if (!date || !name || !weight) { alert('Hammasini to\'ldiring'); return; }
            
            if (!userData.evening) userData.evening = [];
            userData.evening.push({ id: Date.now(), name, weight, sets: 0, reps: 0, actual: 0, status: 'pending', date: date });
            
            await saveUserData();
            document.getElementById('evening-date').value = '';
            document.getElementById('evening-name').value = '';
            document.getElementById('evening-weight').value = '';
            update();
        }

        async function editEvening(id) {
            const e = userData.evening.find(x => x.id === id);
            if (!e) return;
            const actual = prompt('Qilgan:', e.actual);
            if (actual !== null) {
                e.actual = parseInt(actual) || 0;
                e.status = e.actual > 0 ? 'completed' : 'pending';
                await saveUserData();
                update();
            }
        }

        async function deleteEvening(id) {
            userData.evening = userData.evening.filter(x => x.id !== id);
            await saveUserData();
            update();
        }

        async function addFood() {
            const name = document.getElementById('food-name').value.trim();
            const meal = document.getElementById('food-meal').value;
            const type = document.getElementById('food-type').value;
            if (!name) { alert('Ovqat nomini kiriting'); return; }
            
            if (!userData.foods) userData.foods = [];
            userData.foods.push({ id: Date.now(), name, meal, type });
            
            await saveUserData();
            document.getElementById('food-name').value = '';
            update();
        }

        async function deleteFood(id) {
            userData.foods = userData.foods.filter(x => x.id !== id);
            await saveUserData();
            update();
        }

        async function addGoal() {
            const name = document.getElementById('goal-name').value.trim();
            const target = parseInt(document.getElementById('goal-target').value) || 0;
            if (!name || !target) { alert('Hammasini to\'ldiring'); return; }
            
            if (!userData.goals) userData.goals = [];
            userData.goals.push({ id: Date.now(), name, target, current: 0, days: 30 });
            
            await saveUserData();
            document.getElementById('goal-name').value = '';
            document.getElementById('goal-target').value = '';
            update();
        }

        async function editGoal(id) {
            const g = userData.goals.find(x => x.id === id);
            if (!g) return;
            const current = prompt('Joriy:', g.current);
            if (current !== null) {
                g.current = parseInt(current) || 0;
                await saveUserData();
                update();
            }
        }

        async function deleteGoal(id) {
            userData.goals = userData.goals.filter(x => x.id !== id);
            await saveUserData();
            update();
        }
        function generateAIInsights() {
            const morning = userData.morning || [];
            const evening = userData.evening || [];
            const foods = userData.foods || [];
            const settings = userData.settings || { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' };
            
            const completedMorning = morning.filter(m => m.status === 'completed').length;
            const completedEvening = evening.filter(e => e.status === 'completed').length;
            const goodFoods = foods.filter(f => f.type === 'good').length;
            const badFoods = foods.filter(f => f.type === 'bad').length;
            
            let insights = [];
            
            // Shaxsiy ma'lumotlar va BMI
            if (settings.age && settings.height && settings.weight) {
                const heightM = settings.height / 100;
                const bmi = (settings.weight / (heightM * heightM)).toFixed(1);
                let bmiStatus = '';
                if (bmi < 18.5) bmiStatus = 'Ozg\'in';
                else if (bmi < 25) bmiStatus = 'Normal';
                else if (bmi < 30) bmiStatus = 'Ortiqcha vazn';
                else bmiStatus = 'Semiz';
                
                insights.push({
                    icon: 'üìä',
                    title: 'Sizning BMI',
                    text: `BMI: ${bmi} (${bmiStatus}). Yosh: ${settings.age}, Bo'y: ${settings.height}sm, Vazn: ${settings.weight}kg`
                });
            }
            
            // Maqsadga qarab maslahat
            if (settings.goal === 'lose') {
                insights.push({
                    icon: 'üî•',
                    title: 'Vazn Yo\'qotish Rejasi',
                    text: 'Maqsad: Ozish. Kaloriya kamroq iste\'mol qiling. Ko\'proq kardio mashqlar qiling. Sut, yog\'li ovqatlardan qoching!'
                });
                
                // Ovqat maslahati
                insights.push({
                    icon: 'ü•ó',
                    title: 'Ovqatlanish (Ozish uchun)',
                    text: 'Foydali: Sabzavot, meva, tovuq ko\'kragi, baliq, tuxum oqi. Zararli: Shirinlik, fast food, gazli ichimlik, non.'
                });
                
                // Mashq maslahati
                insights.push({
                    icon: 'üèÉ',
                    title: 'Mashqlar (Ozish uchun)',
                    text: 'Kardio: Yugurish, velosiped, sakrash. Kalistenik: Burpee, jumping jack, mountain climber. Kuniga 30-45 daqiqa!'
                });
                
            } else if (settings.goal === 'gain') {
                insights.push({
                    icon: 'üí™',
                    title: 'Vazn Oshirish Rejasi',
                    text: 'Maqsad: Semirib olish. Kaloriya ko\'proq iste\'mol qiling. Og\'ir vazn bilan mashq qiling. Ko\'p ovqatlaning!'
                });
                
                // Ovqat maslahati
                insights.push({
                    icon: 'üçñ',
                    title: 'Ovqatlanish (Semirib olish uchun)',
                    text: 'Foydali: Go\'sht, tuxum, yong\'oq, sut, guruch, kartoshka, banan. Kuniga 5-6 marta ovqatlaning!'
                });
                
                // Mashq maslahati
                insights.push({
                    icon: 'üèãÔ∏è',
                    title: 'Mashqlar (Semirib olish uchun)',
                    text: 'Og\'ir vazn: Squat, deadlift, bench press. Kam takror (6-8). Ko\'p dam oling. Kardio kamroq!'
                });
                
            } else if (settings.goal === 'muscle') {
                insights.push({
                    icon: 'üèÜ',
                    title: 'Mushak Qurish Rejasi',
                    text: 'Maqsad: Bodybuilding. Protein ko\'p iste\'mol qiling. Og\'ir vazn + ko\'p takror. Muntazam mashq!'
                });
                
                // Ovqat maslahati
                insights.push({
                    icon: 'ü•©',
                    title: 'Ovqatlanish (Mushak uchun)',
                    text: 'Protein: Tovuq, baliq, tuxum, protein shake. Uglevod: Guruch, kartoshka. Yog\': Yong\'oq, avokado. Kuniga 2g protein/kg!'
                });
                
                // Mashq maslahati
                insights.push({
                    icon: 'üí™',
                    title: 'Mashqlar (Mushak uchun)',
                    text: 'Split: Push/Pull/Legs. O\'rta vazn, 8-12 takror. Har mushakni haftada 2 marta. Dam olish muhim!'
                });
                
            } else if (settings.goal === 'maintain') {
                insights.push({
                    icon: '‚öñÔ∏è',
                    title: 'Vazn Saqlash Rejasi',
                    text: 'Maqsad: Fit bo\'lish. Muvozanatli ovqatlaning. Muntazam mashq qiling. Sog\'lom turmush tarzi!'
                });
                
                // Ovqat maslahati
                insights.push({
                    icon: 'ü•ô',
                    title: 'Ovqatlanish (Fit bo\'lish uchun)',
                    text: 'Muvozanat: Protein, uglevod, yog\' - hammasi kerak. Sog\'lom ovqatlar. Shirinlik kamroq!'
                });
                
                // Mashq maslahati
                insights.push({
                    icon: 'ü§∏',
                    title: 'Mashqlar (Fit bo\'lish uchun)',
                    text: 'Aralash: Kardio + kuch mashqlari. Haftada 4-5 kun. 30-45 daqiqa. Xilma-xillik muhim!'
                });
            }
            
            // Mashq rejimi bo'yicha maslahat
            if (settings.workoutMode === '1') {
                insights.push({
                    icon: 'üí™',
                    title: 'Mashq rejimi',
                    text: 'Siz kuniga 1 mahal mashq qilasiz. Natija olish uchun muntazam mashq qiling!'
                });
            } else {
                insights.push({
                    icon: 'üî•',
                    title: 'Mashq rejimi',
                    text: 'Siz kuniga 2 mahal mashq qilasiz. Ajoyib! Ertalab va kechqurun mashqlar tezroq natija beradi.'
                });
            }
            
            // Mashq vaqti bo'yicha maslahat
            insights.push({
                icon: '‚è∞',
                title: 'Mashq vaqtlari',
                text: `Ertalab: ${settings.morningTime}, Kechqurun: ${settings.eveningTime}. Vaqtni muntazam saqlang!`
            });
            
            // Ovqatlanish bo'yicha maslahat
            if (goodFoods > badFoods) {
                insights.push({
                    icon: '‚úÖ',
                    title: 'Ovqatlanish',
                    text: `Ajoyib! Siz ko'proq foydali ovqatlar iste'mol qilyapsiz (${goodFoods} foydali, ${badFoods} zararli).`
                });
            } else if (badFoods > goodFoods) {
                insights.push({
                    icon: '‚ö†Ô∏è',
                    title: 'Ovqatlanish',
                    text: `Diqqat! Zararli ovqatlar ko'p (${badFoods} zararli, ${goodFoods} foydali). Foydali ovqatlarga o'ting!`
                });
            } else {
                insights.push({
                    icon: 'üçé',
                    title: 'Ovqatlanish',
                    text: 'Ovqatlanishni yaxshilang. Ko\'proq foydali ovqatlar qo\'shing!'
                });
            }
            
            // Natijalar bo'yicha maslahat
            const totalWorkouts = morning.length + evening.length;
            const completedWorkouts = completedMorning + completedEvening;
            if (totalWorkouts > 0) {
                const percentage = Math.round((completedWorkouts / totalWorkouts) * 100);
                if (percentage >= 80) {
                    insights.push({
                        icon: 'üèÜ',
                        title: 'Natijalar',
                        text: `Zo'r! Siz ${percentage}% mashqlarni bajardingiz. Davom eting!`
                    });
                } else if (percentage >= 50) {
                    insights.push({
                        icon: 'üí™',
                        title: 'Natijalar',
                        text: `Yaxshi! ${percentage}% mashqlar bajarildi. Yana harakat qiling!`
                    });
                } else {
                    insights.push({
                        icon: '‚ö°',
                        title: 'Natijalar',
                        text: `${percentage}% mashqlar bajarildi. Ko'proq harakat qiling!`
                    });
                }
            }
            
            // Foydali maslahatlar
            insights.push({
                icon: 'üí°',
                title: 'Umumiy Maslahat',
                text: 'Maqsadga tezroq erishish uchun: muntazam mashq + to\'g\'ri ovqatlanish + yetarli uyqu (7-8 soat)!'
            });
            
            return insights;
        }
        function update() {
            if (!userData) return;
            
            const today = new Date().toISOString().split('T')[0];

            // Settings
            if (userData.settings) {
                document.getElementById('user-age').value = userData.settings.age || '';
                document.getElementById('user-weight').value = userData.settings.weight || '';
                document.getElementById('user-goal').value = userData.settings.goal || '';
                document.getElementById('workout-mode').value = userData.settings.workoutMode || '';
                updateSettingsInfo();
            }

            // Schedule
            const scheduleList = document.getElementById('schedule-list');
            const schedule = userData.schedule && userData.schedule[today] ? userData.schedule[today] : [];
            schedule.sort((a, b) => a.time.localeCompare(b.time));
            scheduleList.innerHTML = schedule.length > 0 ? schedule.map(t => {
                const completedStyle = t.completed ? 'text-decoration: line-through; opacity: 0.6;' : '';
                const completedIcon = t.completed ? '‚úÖ' : '‚è≥';
                return `
                    <div class="item" style="display: flex; flex-direction: column; gap: 10px;">
                        <span style="${completedStyle}">${completedIcon} ${t.time} ${t.name}</span>
                        <div style="display: flex; gap: 5px; flex-wrap: wrap;">
                            <button onclick="toggleScheduleComplete(${t.id}, true)" style="background: #00ff88; color: #0a0e27; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                ‚úÖ Bajarildi
                            </button>
                            <button onclick="toggleScheduleComplete(${t.id}, false)" style="background: #ffa500; color: #0a0e27; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                ‚ùå Bajarilmadi
                            </button>
                            <button onclick="editSchedule(${t.id})" style="background: #00d4ff; color: #0a0e27; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                ‚úèÔ∏è O'zgartirish
                            </button>
                            <button onclick="deleteSchedule(${t.id})" style="background: #ff0055; color: #fff; border: none; padding: 8px 12px; border-radius: 4px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                üóëÔ∏è O'chirish
                            </button>
                        </div>
                    </div>
                `;
            }).join('') : '<div class="item"><span>Vazifalar yo\'q</span></div>';

            // Morning
            const morningList = document.getElementById('morning-list');
            const morning = userData.morning || [];
            morningList.innerHTML = morning.length > 0 ? morning.map(m => `<div class="item"><span>${m.date} ${m.name}: ${m.actual}/${m.target}</span><div><button onclick="editMorning(${m.id})" style="background: #00d4ff; color: #0a0e27; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Tahrir</button><button onclick="deleteMorning(${m.id})" style="background: #ff0055; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">O'chirish</button></div></div>`).join('') : '<div class="item"><span>Mashqlar yo\'q</span></div>';

            // Evening
            const eveningList = document.getElementById('evening-list');
            const evening = userData.evening || [];
            eveningList.innerHTML = evening.length > 0 ? evening.map(e => `<div class="item"><span>${e.date} ${e.name}: ${e.weight}kg (${e.actual})</span><div><button onclick="editEvening(${e.id})" style="background: #00d4ff; color: #0a0e27; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Tahrir</button><button onclick="deleteEvening(${e.id})" style="background: #ff0055; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">O'chirish</button></div></div>`).join('') : '<div class="item"><span>Mashqlar yo\'q</span></div>';

            // Foods
            const foods = userData.foods || [];
            const breakfastFoods = foods.filter(f => f.meal === 'breakfast');
            const lunchFoods = foods.filter(f => f.meal === 'lunch');
            const dinnerFoods = foods.filter(f => f.meal === 'dinner');
            const snackFoods = foods.filter(f => f.meal === 'snack');
            const drinkFoods = foods.filter(f => f.meal === 'drink');
            
            const renderFoodList = (foodList) => {
                if (foodList.length === 0) return '<div class="item" style="opacity: 0.5;"><span>Ovqatlar yo\'q</span></div>';
                return foodList.map(f => {
                    const borderColor = f.type === 'good' ? '#00ff88' : '#ff0055';
                    const icon = f.type === 'good' ? '‚úÖ' : '‚ùå';
                    return `<div class="item" style="border-left-color: ${borderColor};"><span>${icon} ${f.name}</span><button onclick="deleteFood(${f.id})" style="background: #ff0055; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">O'chirish</button></div>`;
                }).join('');
            };
            
            document.getElementById('food-breakfast-list').innerHTML = renderFoodList(breakfastFoods);
            document.getElementById('food-lunch-list').innerHTML = renderFoodList(lunchFoods);
            document.getElementById('food-dinner-list').innerHTML = renderFoodList(dinnerFoods);
            document.getElementById('food-snack-list').innerHTML = renderFoodList(snackFoods);
            document.getElementById('food-drink-list').innerHTML = renderFoodList(drinkFoods);

            // Goals
            const goalsList = document.getElementById('goals-list');
            const goals = userData.goals || [];
            goalsList.innerHTML = goals.length > 0 ? goals.map(g => `<div class="item"><span>${g.name}: ${g.current}/${g.target}</span><div><button onclick="editGoal(${g.id})" style="background: #00d4ff; color: #0a0e27; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; margin-right: 5px;">Tahrir</button><button onclick="deleteGoal(${g.id})" style="background: #ff0055; color: #fff; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer;">O'chirish</button></div></div>`).join('') : '<div class="item"><span>Maqsadlar yo\'q</span></div>';

            // AI Insights
            const insightsList = document.getElementById('insights-list');
            const insights = generateAIInsights();
            insightsList.innerHTML = insights.map(i => `<div class="item"><div><span style="font-size: 24px; margin-right: 10px;">${i.icon}</span><strong style="color: #00d4ff;">${i.title}</strong><p style="margin-top: 5px; color: #aaa;">${i.text}</p></div></div>`).join('');

            // Weekly
            updateWeeklyStats();

            // Stats
            updateMonthlyStats();
        }

        function updateWeeklyStats() {
            const morning = userData.morning || [];
            const evening = userData.evening || [];
            
            let weekData = [];
            let totalWorkouts = 0;
            let completedWorkouts = 0;
            
            // Oxirgi 7 kunni hisoblash
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                
                const dayMorning = morning.filter(m => m.date === dateStr);
                const dayEvening = evening.filter(e => e.date === dateStr);
                const dayTotal = dayMorning.length + dayEvening.length;
                const dayCompleted = dayMorning.filter(m => m.status === 'completed').length + 
                                    dayEvening.filter(e => e.status === 'completed').length;
                
                totalWorkouts += dayTotal;
                completedWorkouts += dayCompleted;
                
                const dayNames = ['Yak', 'Dush', 'Sesh', 'Chor', 'Pay', 'Jum', 'Shan'];
                const dayName = dayNames[d.getDay()];
                const dayDate = d.getDate();
                const percentage = dayTotal > 0 ? Math.round((dayCompleted / dayTotal) * 100) : 0;
                
                weekData.push({
                    name: dayName,
                    date: dayDate,
                    total: dayTotal,
                    completed: dayCompleted,
                    percentage: percentage
                });
            }
            
            // Umumiy ma'lumotlarni ko'rsatish
            document.getElementById('weekly-total').textContent = totalWorkouts;
            document.getElementById('weekly-completed').textContent = completedWorkouts;
            const weekPercentage = totalWorkouts > 0 ? Math.round((completedWorkouts / totalWorkouts) * 100) : 0;
            document.getElementById('weekly-percentage').textContent = weekPercentage + '%';
            
            // Kunlik taqvim
            const calendar = document.getElementById('weekly-calendar');
            calendar.innerHTML = weekData.map(day => {
                let bgColor = '#0a0e27';
                let borderColor = '#0f3460';
                if (day.percentage >= 80) {
                    bgColor = 'rgba(0, 255, 136, 0.2)';
                    borderColor = '#00ff88';
                } else if (day.percentage >= 50) {
                    bgColor = 'rgba(0, 212, 255, 0.2)';
                    borderColor = '#00d4ff';
                } else if (day.percentage > 0) {
                    bgColor = 'rgba(255, 165, 0, 0.2)';
                    borderColor = '#ffa500';
                } else if (day.total > 0) {
                    bgColor = 'rgba(255, 0, 85, 0.2)';
                    borderColor = '#ff0055';
                }
                
                return `
                    <div style="background: ${bgColor}; border: 2px solid ${borderColor}; border-radius: 8px; padding: 15px; text-align: center;">
                        <div style="color: #00d4ff; font-weight: bold; margin-bottom: 5px;">${day.name}</div>
                        <div style="color: #fff; font-size: 20px; font-weight: bold; margin-bottom: 5px;">${day.date}</div>
                        <div style="color: #aaa; font-size: 12px; margin-bottom: 5px;">${day.completed}/${day.total}</div>
                        <div style="color: ${borderColor}; font-weight: bold; font-size: 14px;">${day.percentage}%</div>
                    </div>
                `;
            }).join('');
            
            // Haftalik grafik
            const chart = document.getElementById('weekly-chart');
            const maxValue = Math.max(...weekData.map(d => d.total), 1);
            
            chart.innerHTML = `
                <div style="display: flex; align-items: flex-end; justify-content: space-around; height: 100%; padding: 10px 0;">
                    ${weekData.map(day => {
                        const height = day.total > 0 ? (day.completed / maxValue) * 100 : 0;
                        const totalHeight = (day.total / maxValue) * 100;
                        return `
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; margin: 0 5px;">
                                <div style="font-size: 12px; color: #00d4ff; margin-bottom: 5px; font-weight: bold;">${day.completed}</div>
                                <div style="width: 100%; background: #0a0e27; border: 2px solid #0f3460; border-radius: 4px; position: relative; height: ${totalHeight}%; min-height: 20px;">
                                    <div style="width: 100%; background: linear-gradient(180deg, #00d4ff, #00ff88); border-radius: 2px; height: ${day.total > 0 ? (day.completed / day.total) * 100 : 0}%;"></div>
                                </div>
                                <div style="font-size: 11px; color: #aaa; margin-top: 5px;">${day.name}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function updateMonthlyStats() {
            const morning = userData.morning || [];
            const evening = userData.evening || [];
            const foods = userData.foods || [];
            
            // Umumiy statistika
            const totalWorkouts = morning.length + evening.length;
            const completedWorkouts = morning.filter(m => m.status === 'completed').length + 
                                     evening.filter(e => e.status === 'completed').length;
            const pendingWorkouts = totalWorkouts - completedWorkouts;
            const successRate = totalWorkouts > 0 ? Math.round((completedWorkouts / totalWorkouts) * 100) : 0;
            
            document.getElementById('total-workouts').textContent = totalWorkouts;
            document.getElementById('completed-workouts').textContent = completedWorkouts;
            document.getElementById('pending-workouts').textContent = pendingWorkouts;
            document.getElementById('success-rate').textContent = successRate + '%';
            
            // Oylik ma'lumot (oxirgi 30 kun)
            let monthMorning = 0;
            let monthEvening = 0;
            let monthTotal = 0;
            let monthCompleted = 0;
            
            for (let i = 0; i < 30; i++) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                
                const dayMorning = morning.filter(m => m.date === dateStr);
                const dayEvening = evening.filter(e => e.date === dateStr);
                
                monthMorning += dayMorning.filter(m => m.status === 'completed').length;
                monthEvening += dayEvening.filter(e => e.status === 'completed').length;
                monthTotal += dayMorning.length + dayEvening.length;
                monthCompleted += dayMorning.filter(m => m.status === 'completed').length + 
                                 dayEvening.filter(e => e.status === 'completed').length;
            }
            
            document.getElementById('monthly-morning').textContent = monthMorning;
            document.getElementById('monthly-evening').textContent = monthEvening;
            
            const maxMonthly = Math.max(monthMorning, monthEvening, 1);
            document.getElementById('monthly-morning-bar').style.width = (monthMorning / maxMonthly * 100) + '%';
            document.getElementById('monthly-evening-bar').style.width = (monthEvening / maxMonthly * 100) + '%';
            
            // Doira grafik
            const monthPercentage = monthTotal > 0 ? Math.round((monthCompleted / monthTotal) * 100) : 0;
            document.getElementById('monthly-percentage').textContent = monthPercentage + '%';
            
            const circumference = 2 * Math.PI * 40;
            const offset = circumference - (monthPercentage / 100) * circumference;
            document.getElementById('progress-circle').style.strokeDashoffset = offset;
            
            // Ovqatlanish statistikasi
            const goodFoods = foods.filter(f => f.type === 'good').length;
            const badFoods = foods.filter(f => f.type === 'bad').length;
            const totalFoods = goodFoods + badFoods;
            const foodPercentage = totalFoods > 0 ? Math.round((goodFoods / totalFoods) * 100) : 0;
            
            document.getElementById('good-foods-count').textContent = goodFoods;
            document.getElementById('bad-foods-count').textContent = badFoods;
            document.getElementById('food-percentage').textContent = foodPercentage + '%';
            
            const foodCircumference = 2 * Math.PI * 35;
            const foodOffset = foodCircumference - (foodPercentage / 100) * foodCircumference;
            document.getElementById('food-circle').style.strokeDashoffset = foodOffset;
            
            // Yillik grafik (oxirgi 12 oy)
            const yearlyChart = document.getElementById('yearly-chart');
            let monthlyData = [];
            
            for (let i = 11; i >= 0; i--) {
                const d = new Date();
                d.setMonth(d.getMonth() - i);
                const monthStart = new Date(d.getFullYear(), d.getMonth(), 1);
                const monthEnd = new Date(d.getFullYear(), d.getMonth() + 1, 0);
                
                let monthWorkouts = 0;
                let monthCompletedWorkouts = 0;
                
                for (let day = monthStart; day <= monthEnd; day.setDate(day.getDate() + 1)) {
                    const dateStr = day.toISOString().split('T')[0];
                    const dayMorning = morning.filter(m => m.date === dateStr);
                    const dayEvening = evening.filter(e => e.date === dateStr);
                    monthWorkouts += dayMorning.length + dayEvening.length;
                    monthCompletedWorkouts += dayMorning.filter(m => m.status === 'completed').length + 
                                             dayEvening.filter(e => e.status === 'completed').length;
                }
                
                const monthNames = ['Yan', 'Fev', 'Mar', 'Apr', 'May', 'Iyun', 'Iyul', 'Avg', 'Sen', 'Okt', 'Noy', 'Dek'];
                monthlyData.push({
                    name: monthNames[d.getMonth()],
                    total: monthWorkouts,
                    completed: monthCompletedWorkouts
                });
            }
            
            const maxYearly = Math.max(...monthlyData.map(m => m.total), 1);
            
            yearlyChart.innerHTML = `
                <div style="display: flex; align-items: flex-end; justify-content: space-around; height: 100%; padding: 10px 0;">
                    ${monthlyData.map(month => {
                        const height = month.total > 0 ? (month.completed / maxYearly) * 100 : 0;
                        const totalHeight = (month.total / maxYearly) * 100;
                        return `
                            <div style="flex: 1; display: flex; flex-direction: column; align-items: center; margin: 0 3px;">
                                <div style="font-size: 11px; color: #00d4ff; margin-bottom: 5px; font-weight: bold;">${month.completed}</div>
                                <div style="width: 100%; background: #0a0e27; border: 2px solid #0f3460; border-radius: 4px; position: relative; height: ${totalHeight}%; min-height: 15px;">
                                    <div style="width: 100%; background: linear-gradient(180deg, #00d4ff, #00ff88); border-radius: 2px; height: ${month.total > 0 ? (month.completed / month.total) * 100 : 0}%;"></div>
                                </div>
                                <div style="font-size: 10px; color: #aaa; margin-top: 5px;">${month.name}</div>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        // AI Chat Functions
        function generateNutritionPlan() {
            // Open AI Chat Modal for nutrition questions
            openAINutritionChat();
        }
        
        // Food Analysis Function
        function analyzeFoodBenefits(question) {
            const q = question.toLowerCase();
            
            // Display plan
            document.getElementById('nutrition-content').innerHTML = plan;
            document.getElementById('nutrition-plan').classList.remove('hidden');
            
            // Scroll to plan
            document.getElementById('nutrition-plan').scrollIntoView({ behavior: 'smooth' });
        }
        
        function getNutritionPlanByGoal(goal, age, weight, calories, protein, carbs, fats) {
            let html = '';
            
            // Header with user info
            html += `
                <div style="background: #0a0e27; border: 2px solid #00d4ff; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                    <h3 style="color: #00d4ff; margin-bottom: 15px;">üìä SIZNING MA'LUMOTLARINGIZ</h3>
                    <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px;">
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${age}</div>
                            <div style="color: #aaa; font-size: 12px;">Yosh</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${weight}kg</div>
                            <div style="color: #aaa; font-size: 12px;">Vazn</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${calories}</div>
                            <div style="color: #aaa; font-size: 12px;">Kaloriya/kun</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 24px; font-weight: bold; color: #00ff88;">${protein}g</div>
                            <div style="color: #aaa; font-size: 12px;">Protein/kun</div>
                        </div>
                    </div>
                </div>
            `;
            
            // Goal-specific plan
            if (goal === 'lose') {
                html += `
                    <div style="background: #ff0055; color: #fff; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin: 0;">üî• VAZN YO'QOTISH REJASI</h3>
                    </div>
                    
                    ${getMealSection('üåÖ NONUSHTA (07:00-08:00)', [
                        '2 ta tuxum (qaynatilgan yoki omlet)',
                        '1 piyola yulaf (oatmeal) sut bilan',
                        '1 ta olma yoki banan',
                        '1 stakan yashil choy (shakarsiz)'
                    ], '400-450 kaloriya')}
                    
                    ${getMealSection('‚òï ERTALABKI ATISHTIRISHLAR (10:00-10:30)', [
                        '1 hovuch yong\'oq (bodom, yeryong\'oq)',
                        '1 ta meva (olma, nok)',
                        '1 stakan suv'
                    ], '150-200 kaloriya')}
                    
                    ${getMealSection('‚òÄÔ∏è TUSHLIK (12:30-13:30)', [
                        '150g tovuq ko\'kragi (qovurilgan yoki bug\'da)',
                        'Ko\'p sabzavot salati (pomidor, bodring, karam)',
                        '100g guruch yoki grechka',
                        '1 stakan suv'
                    ], '500-550 kaloriya')}
                    
                    ${getMealSection('üçé TUSHDAN KEYIN ATISHTIRISHLAR (16:00-16:30)', [
                        '1 stakan kefir yoki yogurt (yog\'siz)',
                        '1 ta meva',
                        'Bir hovuch yeryong\'oq'
                    ], '150-200 kaloriya')}
                    
                    ${getMealSection('üåô KECHKI OVQAT (18:30-19:30)', [
                        '150g baliq (qovurilgan yoki bug\'da)',
                        'Ko\'p sabzavot (bug\'da yoki xom)',
                        '2 ta tuxum oqi',
                        '1 stakan yashil choy'
                    ], '400-450 kaloriya')}
                    
                    ${getWaterSection()}
                    ${getProhibitedFoods(['Shirinlik va tort', 'Fast food (gamburger, pizza)', 'Gazli ichimliklar', 'Non va bulka', 'Yog\'li ovqatlar', 'Alkogol'])}
                    ${getTips(['Och qoringa 2 stakan iliq suv iching', 'Har ovqatdan 20 daqiqa oldin 1 stakan suv iching', 'Kechki ovqatni uxlashdan 3 soat oldin yeng', 'Shirinlikni meva bilan almashtiring', 'Har kuni 10,000 qadam yuring'])}
                `;
            } else if (goal === 'gain') {
                html += `
                    <div style="background: #00ff88; color: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin: 0;">üí™ VAZN OSHIRISH REJASI</h3>
                    </div>
                    
                    ${getMealSection('üåÖ NONUSHTA (07:00-08:00)', [
                        '3-4 ta tuxum (omlet yoki qovurilgan)',
                        '2 piyola yulaf (oatmeal) sut va asal bilan',
                        '2 ta banan',
                        '1 stakan sut',
                        '1 osh qoshiq yeryong\'oq moyi'
                    ], '700-800 kaloriya')}
                    
                    ${getMealSection('‚òï ERTALABKI ATISHTIRISHLAR (10:00-10:30)', [
                        'Protein shake (30g protein)',
                        '2 ta banan',
                        '1 hovuch yong\'oq',
                        '1 stakan sut'
                    ], '400-450 kaloriya')}
                    
                    ${getMealSection('‚òÄÔ∏è TUSHLIK (12:30-13:30)', [
                        '200g go\'sht (mol yoki qo\'y)',
                        '200g guruch yoki makaron',
                        'Sabzavot salati (zaytun moyi bilan)',
                        '2 ta kartoshka',
                        '1 stakan kompot'
                    ], '800-900 kaloriya')}
                    
                    ${getMealSection('üçé TUSHDAN KEYIN ATISHTIRISHLAR (16:00-16:30)', [
                        'Protein shake (30g protein)',
                        '2 ta tuxum (qaynatilgan)',
                        '1 ta avokado',
                        '1 hovuch yong\'oq'
                    ], '400-450 kaloriya')}
                    
                    ${getMealSection('üåô KECHKI OVQAT (18:30-19:30)', [
                        '200g tovuq yoki baliq',
                        '150g guruch',
                        'Ko\'p sabzavot',
                        '2 ta tuxum',
                        '1 stakan sut'
                    ], '700-750 kaloriya')}
                    
                    ${getMealSection('üåÉ UXLASHDAN OLDIN (21:00-21:30)', [
                        '1 stakan sut',
                        '50g tvorog (cottage cheese)',
                        '1 osh qoshiq asal'
                    ], '200-250 kaloriya')}
                    
                    ${getWaterSection()}
                    ${getRecommendedFoods(['Go\'sht va tovuq', 'Tuxum (5-6 ta/kun)', 'Sut mahsulotlari', 'Yong\'oq va yeryong\'oq moyi', 'Guruch va makaron', 'Meva (banan, avokado)', 'Protein shake'])}
                    ${getTips(['Har 2-3 soatda ovqatlaning', 'Protein shake mashqdan keyin', 'Yog\'li ovqatlardan qo\'rqmang', 'Katta porsiyalarda yeng', 'Yetarli uxlang (8-9 soat)'])}
                `;
            } else if (goal === 'muscle') {
                html += `
                    <div style="background: #ffa500; color: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin: 0;">üèÜ MUSHAK QURISH REJASI</h3>
                    </div>
                    
                    ${getMealSection('üåÖ NONUSHTA (07:00-08:00)', [
                        '4 ta tuxum (3 butun + 1 oq)',
                        '1.5 piyola yulaf sut bilan',
                        '1 ta banan',
                        '1 stakan sut',
                        '1 osh qoshiq yeryong\'oq moyi'
                    ], '600-650 kaloriya')}
                    
                    ${getMealSection('‚òï ERTALABKI ATISHTIRISHLAR (10:00-10:30)', [
                        'Protein shake (25-30g protein)',
                        '1 ta banan',
                        '1 hovuch yong\'oq'
                    ], '300-350 kaloriya')}
                    
                    ${getMealSection('‚òÄÔ∏è TUSHLIK (12:30-13:30)', [
                        '200g tovuq ko\'kragi',
                        '150g guruch yoki grechka',
                        'Ko\'p sabzavot salati',
                        '1 ta kartoshka',
                        '1 stakan suv'
                    ], '700-750 kaloriya')}
                    
                    ${getMealSection('üèãÔ∏è MASHQDAN OLDIN (1 soat oldin)', [
                        '1 ta banan',
                        '1 piyola yulaf',
                        '1 stakan qahva (shakarsiz)'
                    ], '200-250 kaloriya')}
                    
                    ${getMealSection('üí™ MASHQDAN KEYIN (30 daqiqa ichida)', [
                        'Protein shake (30-40g protein)',
                        '2 ta banan',
                        '1 stakan sut'
                    ], '400-450 kaloriya')}
                    
                    ${getMealSection('üåô KECHKI OVQAT (18:30-19:30)', [
                        '200g go\'sht yoki baliq',
                        '150g guruch',
                        'Ko\'p sabzavot',
                        '2 ta tuxum',
                        '1 stakan suv'
                    ], '700-750 kaloriya')}
                    
                    ${getMealSection('üåÉ UXLASHDAN OLDIN (21:00)', [
                        '100g tvorog (cottage cheese)',
                        '1 stakan kefir',
                        '1 hovuch yong\'oq'
                    ], '250-300 kaloriya')}
                    
                    ${getWaterSection()}
                    ${getSupplements()}
                    ${getTips(['Mashqdan keyin 30 daqiqa ichida protein', 'Har kg vazn uchun 2g protein', 'Uglevodni mashqdan oldin va keyin', 'Yetarli uxlang (8 soat)', 'Progressiv overload - vazn oshiring'])}
                `;
            } else {
                html += `
                    <div style="background: #00d4ff; color: #0a0e27; padding: 15px; border-radius: 8px; margin-bottom: 20px; text-align: center;">
                        <h3 style="margin: 0;">‚öñÔ∏è SOG'LOM TURMUSH TARZI</h3>
                    </div>
                    
                    ${getMealSection('üåÖ NONUSHTA (07:00-08:00)', [
                        '2-3 ta tuxum',
                        '1 piyola yulaf',
                        '1 ta meva',
                        '1 stakan choy yoki qahva'
                    ], '450-500 kaloriya')}
                    
                    ${getMealSection('‚òï ERTALABKI ATISHTIRISHLAR (10:00-10:30)', [
                        '1 ta meva',
                        '1 hovuch yong\'oq',
                        '1 stakan suv'
                    ], '150-200 kaloriya')}
                    
                    ${getMealSection('‚òÄÔ∏è TUSHLIK (12:30-13:30)', [
                        '150g tovuq yoki baliq',
                        '150g guruch yoki makaron',
                        'Sabzavot salati',
                        '1 stakan suv'
                    ], '600-650 kaloriya')}
                    
                    ${getMealSection('üçé TUSHDAN KEYIN ATISHTIRISHLAR (16:00-16:30)', [
                        '1 stakan yogurt',
                        '1 ta meva',
                        'Bir hovuch yong\'oq'
                    ], '200-250 kaloriya')}
                    
                    ${getMealSection('üåô KECHKI OVQAT (18:30-19:30)', [
                        '150g go\'sht yoki baliq',
                        '100g guruch',
                        'Ko\'p sabzavot',
                        '1 stakan suv'
                    ], '500-550 kaloriya')}
                    
                    ${getWaterSection()}
                    ${getBalancedDiet()}
                    ${getTips(['Muvozanatli ovqatlaning', 'Shirinlik kamroq', 'Ko\'p sabzavot va meva', 'Yetarli suv iching', 'Muntazam mashq qiling'])}
                `;
            }
            
            return html;
        }
        
        function getMealSection(title, foods, calories) {
            return `
                <div style="background: #1a2332; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 15px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="color: #00d4ff; margin: 0;">${title}</h3>
                        <span style="background: #00ff88; color: #0a0e27; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 12px;">${calories}</span>
                    </div>
                    <ul style="margin: 0; padding-left: 20px; color: #fff; line-height: 2;">
                        ${foods.map(food => `<li>${food}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        function getWaterSection() {
            return `
                <div style="background: linear-gradient(135deg, #00d4ff 0%, #00ff88 100%); color: #0a0e27; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 15px 0;">üíß SUV ICHISH JADVALI</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2; font-weight: 500;">
                        <li>Uyg'onganda: 2 stakan iliq suv (och qoringa)</li>
                        <li>Har ovqatdan 20 daqiqa oldin: 1 stakan suv</li>
                        <li>Mashq paytida: Har 15 daqiqada 1 stakan</li>
                        <li>Mashqdan keyin: 2-3 stakan suv</li>
                        <li>Uxlashdan 1 soat oldin: 1 stakan suv</li>
                        <li><strong>JAMI: 2.5-3 litr/kun (10-12 stakan)</strong></li>
                    </ul>
                </div>
            `;
        }
        
        function getProhibitedFoods(foods) {
            return `
                <div style="background: #ff0055; color: #fff; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 15px 0;">‚ùå YEMASLIGI KERAK</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                        ${foods.map(food => `<li>${food}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        function getRecommendedFoods(foods) {
            return `
                <div style="background: #00ff88; color: #0a0e27; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 15px 0;">‚úÖ KO'PROQ YEYISH KERAK</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2; font-weight: 500;">
                        ${foods.map(food => `<li>${food}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        function getBalancedDiet() {
            return `
                <div style="background: #00d4ff; color: #0a0e27; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 15px 0;">‚öñÔ∏è MUVOZANATLI OVQATLANISH</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2; font-weight: 500;">
                        <li>Protein: Go\'sht, tovuq, baliq, tuxum</li>
                        <li>Uglevod: Guruch, makaron, kartoshka, non</li>
                        <li>Yog\': Yong\'oq, avokado, zaytun moyi</li>
                        <li>Sabzavot: Har xil rangdagi sabzavotlar</li>
                        <li>Meva: 2-3 ta meva har kuni</li>
                    </ul>
                </div>
            `;
        }
        
        function getSupplements() {
            return `
                <div style="background: #ffa500; color: #0a0e27; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                    <h3 style="margin: 0 0 15px 0;">üíä QO'SHIMCHA OVQATLAR (SUPPLEMENTS)</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2; font-weight: 500;">
                        <li><strong>Protein Shake:</strong> Mashqdan keyin 30g</li>
                        <li><strong>Creatine:</strong> 5g har kuni</li>
                        <li><strong>BCAA:</strong> Mashq paytida</li>
                        <li><strong>Multivitamin:</strong> Ertalab 1 ta</li>
                        <li><strong>Omega-3:</strong> Kechqurun 1-2 ta</li>
                    </ul>
                </div>
            `;
        }
        
        function getTips(tips) {
            return `
                <div style="background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); border: 2px solid #00d4ff; color: #fff; padding: 20px; border-radius: 8px;">
                    <h3 style="color: #00d4ff; margin: 0 0 15px 0;">üí° MUHIM MASLAHATLAR</h3>
                    <ul style="margin: 0; padding-left: 20px; line-height: 2;">
                        ${tips.map(tip => `<li>${tip}</li>`).join('')}
                    </ul>
                </div>
            `;
        }
        
        // Food Analysis Function
        function analyzeFoodBenefits(question) {
            const q = question.toLowerCase();
            
            // Common foods database
            const foods = {
                'tuxum': { name: 'Tuxum', benefit: '‚úÖ FOYDALI', details: 'Yuqori sifatli protein (6g/dona), vitamin D, B12, xolin. Mushak qurish va miya uchun ajoyib. Kuniga 2-4 ta yeyish mumkin.', harm: 'Haddan tashqari iste\'mol (6+ dona/kun) xolesterin oshirishi mumkin.' },
                'tovuq': { name: 'Tovuq ko\'kragi', benefit: '‚úÖ FOYDALI', details: 'Yuqori protein (30g/100g), kam yog\'. Mushak qurish uchun eng yaxshi. Qovurilgan yoki bug\'da tayyorlang.', harm: 'Terisi bilan yog\'li. Terisiz yeng.' },
                'baliq': { name: 'Baliq', benefit: '‚úÖ FOYDALI', details: 'Omega-3, protein, vitamin D. Yurak va miya uchun juda foydali. Haftada 2-3 marta yeng.', harm: 'Ba\'zi baliqlar simob tutishi mumkin. Katta baliqlardan ehtiyot bo\'ling.' },
                'guruch': { name: 'Guruch', benefit: '‚úÖ FOYDALI', details: 'Toza uglevod, energiya manbai. Mashqdan oldin va keyin yaxshi. Jigarrang guruch ko\'proq foydali.', harm: 'Oq guruch glikemik indeksi yuqori. Jigarrang guruchchni tanlang.' },
                'kartoshka': { name: 'Kartoshka', benefit: '‚úÖ FOYDALI', details: 'Uglevod, kaliy, vitamin C. Energiya beradi. Qaynatilgan yoki pishirilgan holda yeng.', harm: 'Qovurilgan kartoshka yog\'li va zararli. Chipslarga aylantirmang!' },
                'banan': { name: 'Banan', benefit: '‚úÖ FOYDALI', details: 'Tez energiya, kaliy, vitamin B6. Mashqdan oldin va keyin ajoyib. Mushak kramlarini oldini oladi.', harm: 'Shakar ko\'p. Diabetiklar ehtiyot bo\'lsin.' },
                'olma': { name: 'Olma', benefit: '‚úÖ FOYDALI', details: 'Tolalar, vitamin C, antioksidantlar. Ovqat hazm qilishni yaxshilaydi. Kuniga 1-2 ta.', harm: 'Urug\'lari zaharli. Urug\'larini yemang.' },
                'yong\'oq': { name: 'Yong\'oq', benefit: '‚úÖ FOYDALI', details: 'Foydali yog\', protein, vitamin E. Miya va yurak uchun ajoyib. Kuniga bir hovuch.', harm: 'Kaloriya ko\'p (600 kcal/100g). Haddan tashqari yemang.' },
                'avokado': { name: 'Avokado', benefit: '‚úÖ FOYDALI', details: 'Foydali yog\', tolalar, kaliy. Yurak uchun juda foydali. Vazn oshirish uchun ajoyib.', harm: 'Kaloriya ko\'p. Vazn yo\'qotayotganlar ehtiyot bo\'lsin.' },
                'sut': { name: 'Sut', benefit: '‚úÖ FOYDALI', details: 'Protein, kaltsiy, vitamin D. Suyak va mushak uchun foydali. Mashqdan keyin yaxshi.', harm: 'Ba\'zilar laktoza qabul qilmaydi. Yog\'siz sutni tanlang.' },
                'shirinlik': { name: 'Shirinlik', benefit: '‚ùå ZARARLI', details: 'Faqat shakar, hech qanday foyda yo\'q. Vazn oshiradi, tish buzadi, diabetga olib keladi.', harm: 'Juda zararli! Kamroq yeng yoki butunlay tashlab yuboring.' },
                'coca cola': { name: 'Coca Cola', benefit: '‚ùå ZARARLI', details: 'Shakar va kimyoviy moddalar. Tish buzadi, vazn oshiradi, suyaklarni zaiflashtiradi.', harm: 'Juda zararli! Suv iching, gazli ichimlik emas.' },
                'pizza': { name: 'Pizza', benefit: '‚ùå ZARARLI', details: 'Yog\', shakar, kam protein. Fast food - sog\'liq uchun yomon. Kaloriya juda ko\'p.', harm: 'Haftada 1 martadan ko\'p yemang. Uyda tayyorlangan pizza yaxshiroq.' },
                'gamburger': { name: 'Gamburger', benefit: '‚ùå ZARARLI', details: 'Yog\'li, kam vitamin. Fast food - vazn oshiradi, yurak uchun yomon.', harm: 'Kamroq yeng. Uyda sog\'lom burger tayyorlang.' },
                'non': { name: 'Non', benefit: '‚ö†Ô∏è EHTIYOT', details: 'Uglevod manbai. Oq non glikemik indeksi yuqori. Qora non yaxshiroq - tolalar ko\'p.', harm: 'Oq non vazn oshiradi. Qora non yoki to\'liq donli non tanlang.' },
                'makaron': { name: 'Makaron', benefit: '‚ö†Ô∏è EHTIYOT', details: 'Uglevod, energiya. Mashqdan oldin yaxshi. To\'liq donli makaron foydali roq.', harm: 'Oq makaron glikemik indeksi yuqori. Porsiyani nazorat qiling.' },
                'yogurt': { name: 'Yogurt', benefit: '‚úÖ FOYDALI', details: 'Protein, probiotiklar, kaltsiy. Ovqat hazm qilish uchun juda yaxshi. Yog\'siz yogurt tanlang.', harm: 'Shakarli yogurt zararli. Tabiiy yogurt tanlang.' },
                'tvorog': { name: 'Tvorog (Cottage Cheese)', benefit: '‚úÖ FOYDALI', details: 'Yuqori protein, kam yog\'. Uxlashdan oldin yeyish mumkin - sekin hazm bo\'ladi.', harm: 'Tuz ko\'p bo\'lishi mumkin. Kam tuzli tanlang.' },
                'shakar': { name: 'Shakar', benefit: '‚ùå ZARARLI', details: 'Bo\'sh kaloriya, hech qanday vitamin yo\'q. Vazn oshiradi, diabetga olib keladi.', harm: 'Juda zararli! Asal bilan almashtiring.' },
                'asal': { name: 'Asal', benefit: '‚úÖ FOYDALI', details: 'Tabiiy shakar, antioksidantlar, antibakterial. Shakardan yaxshiroq. Lekin kaloriya ko\'p.', harm: 'Haddan tashqari yemang. Kuniga 1-2 osh qoshiq.' },
                'sabzavot': { name: 'Sabzavot', benefit: '‚úÖ FOYDALI', details: 'Vitamin, mineral, tolalar. Kaloriya kam. Istalgancha yeng - vazn yo\'qotish uchun ajoyib.', harm: 'Hech qanday zarar yo\'q. Ko\'proq yeng!' },
                'meva': { name: 'Meva', benefit: '‚úÖ FOYDALI', details: 'Vitamin, tolalar, antioksidantlar. Tabiiy shakar. Kuniga 2-3 ta meva yeng.', harm: 'Shakar ko\'p. Diabetiklar ehtiyot bo\'lsin.' }
            };
            
            // Find mentioned food
            let foundFood = null;
            for (let key in foods) {
                if (q.includes(key)) {
                    foundFood = foods[key];
                    break;
                }
            }
            
            if (foundFood) {
                return `üçΩÔ∏è <strong>${foundFood.name}</strong>\n\n${foundFood.benefit}\n\n<strong>üìä TAHLIL:</strong>\n${foundFood.details}\n\n<strong>‚ö†Ô∏è OGOHLANTIRISH:</strong>\n${foundFood.harm}\n\nüí° <strong>XULOSA:</strong> ${foundFood.benefit === '‚úÖ FOYDALI' ? 'Bu ovqatni muntazam iste\'mol qilishingiz mumkin!' : foundFood.benefit === '‚ùå ZARARLI' ? 'Bu ovqatdan qochishga harakat qiling!' : 'Ehtiyot bilan va o\'lchovda iste\'mol qiling!'}`;
            }
            
            // General response
            return "üçΩÔ∏è OVQAT TAHLILI\n\nOvqat nomini aniq yozing, men uning foydali yoki zararli ekanligini aytaman!\n\nMasalan:\n‚Ä¢ \"Tuxum foydali mi?\"\n‚Ä¢ \"Coca Cola zararli mi?\"\n‚Ä¢ \"Banan yaxshi mi?\"\n‚Ä¢ \"Pizza foydali mi?\"\n\nYoki ovqat nomini yozing: tuxum, tovuq, baliq, guruch, kartoshka, banan, olma, yong'oq, avokado, sut, shirinlik, coca cola, pizza, gamburger, non, makaron, yogurt, tvorog, shakar, asal, sabzavot, meva...";
        }
        
        // AI Chat Functions
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message) return;
            
            // Add user message
            addChatMessage(message, 'user');
            input.value = '';
            
            // Show typing indicator
            showTypingIndicator();
            
            // Get AI response after delay
            setTimeout(() => {
                hideTypingIndicator();
                const response = getAIResponse(message);
                addChatMessage(response, 'ai');
            }, 1000);
        }

        function askQuickQuestion(question) {
            document.getElementById('chat-input').value = question;
            sendMessage();
        }

        function addChatMessage(message, type) {
            const messagesDiv = document.getElementById('chat-messages');
            
            // Remove welcome message if exists
            const welcome = messagesDiv.querySelector('[style*="text-align: center"]');
            if (welcome) welcome.remove();
            
            const messageDiv = document.createElement('div');
            messageDiv.style.marginBottom = '15px';
            messageDiv.style.display = 'flex';
            messageDiv.style.gap = '10px';
            messageDiv.style.alignItems = 'flex-start';
            
            if (type === 'user') {
                messageDiv.style.flexDirection = 'row-reverse';
                messageDiv.innerHTML = `
                    <div style="background: #00d4ff; color: #0a0e27; padding: 12px 16px; border-radius: 18px 18px 4px 18px; max-width: 70%; word-wrap: break-word;">
                        ${message}
                    </div>
                    <div style="font-size: 24px;">üë§</div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div style="font-size: 24px;">ü§ñ</div>
                    <div style="background: #16213e; color: #fff; padding: 12px 16px; border-radius: 18px 18px 18px 4px; max-width: 70%; word-wrap: break-word; border: 2px solid #0f3460;">
                        ${message}
                    </div>
                `;
            }
            
            messagesDiv.appendChild(messageDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function showTypingIndicator() {
            const messagesDiv = document.getElementById('chat-messages');
            const typingDiv = document.createElement('div');
            typingDiv.id = 'typing-indicator';
            typingDiv.style.marginBottom = '15px';
            typingDiv.style.display = 'flex';
            typingDiv.style.gap = '10px';
            typingDiv.style.alignItems = 'center';
            typingDiv.innerHTML = `
                <div style="font-size: 24px;">ü§ñ</div>
                <div style="background: #16213e; color: #aaa; padding: 12px 16px; border-radius: 18px; border: 2px solid #0f3460;">
                    <span style="animation: blink 1.4s infinite;">‚óè</span>
                    <span style="animation: blink 1.4s infinite 0.2s;">‚óè</span>
                    <span style="animation: blink 1.4s infinite 0.4s;">‚óè</span>
                </div>
            `;
            messagesDiv.appendChild(typingDiv);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        function hideTypingIndicator() {
            const typing = document.getElementById('typing-indicator');
            if (typing) typing.remove();
        }

        function getAIResponse(question) {
            const q = question.toLowerCase();
            const settings = userData.settings || {};
            const goal = settings.goal || '';
            const age = settings.age || 0;
            const weight = settings.weight || 0;
            const height = settings.height || 0;
            
            // Check if asking about food benefits/harms
            if (q.includes('foydali') || q.includes('zararli') || q.includes('yaxshi') || q.includes('yomon')) {
                return analyzeFoodBenefits(q);
            }
            
            // Mashq haqida
            if (q.includes('mashq') && (q.includes('nima uchun') || q.includes('nega'))) {
                if (goal === 'lose') {
                    return "Mashq qilish metabolizmingizni tezlashtiradi va kaloriya yoqadi. Muntazam mashq qilsangiz, vazn yo'qotish jarayoni 2-3 baravar tezlashadi. Shuningdek, mushaklar saqlanadi va faqat yog' yo'qoladi. üí™";
                } else if (goal === 'gain') {
                    return "Mashq qilish mushak o'sishini rag'batlantiradi. Og'ir vazn bilan mashq qilsangiz, mushak tolalari shikastlanadi va qayta tiklanishda kuchliroq bo'lib o'sadi. Bu jarayon uchun protein va dam olish muhim. üèãÔ∏è";
                } else if (goal === 'muscle') {
                    return "Bodybuilding uchun mashq muhim! Har bir mushak guruhini haftada 2 marta ishlatsangiz, maksimal o'sish bo'ladi. Push/Pull/Legs split eng samarali usul. 8-12 takror, 3-4 set optimal. üí™";
                } else {
                    return "Mashq qilish sog'ligingiz uchun juda muhim! Yurak-qon tomir tizimini mustahkamlaydi, immunitetni oshiradi, ruhiy holatni yaxshilaydi va energiya beradi. Haftada kamida 3-4 kun mashq qiling! üèÉ";
                }
            }
            
            // Ovqat haqida
            if (q.includes('ovqat') || q.includes('yeyish') || q.includes('iste\'mol')) {
                if (goal === 'lose') {
                    return "Vazn yo'qotish uchun:\n\n‚úÖ Yeyish kerak: Sabzavot, meva, tovuq ko'kragi, baliq, tuxum oqi, yashil choy\n\n‚ùå Yemasligi kerak: Shirinlik, fast food, gazli ichimlik, non, yog'li ovqatlar\n\nKuniga 1500-1800 kaloriya yetarli. Kichik porsiyalarda, 5-6 marta ovqatlaning. ü•ó";
                } else if (goal === 'gain') {
                    return "Vazn oshirish uchun:\n\n‚úÖ Ko'p yeyish kerak: Go'sht, tuxum, yong'oq, sut, guruch, kartoshka, banan, avokado\n\nKuniga 2500-3000 kaloriya kerak. Har 2-3 soatda ovqatlaning. Protein shake ichish yaxshi. Yog'li ovqatlardan qo'rqmang! üçñ";
                } else if (goal === 'muscle') {
                    return "Mushak qurish uchun:\n\nü•© Protein: Har kg vazn uchun 2g protein (masalan, 70kg bo'lsangiz, 140g protein)\n\nüçö Uglevod: Mashqdan oldin va keyin ko'proq\n\nü•ë Yog': Yong'oq, avokado, baliq yog'i\n\nProtein shake, tuxum, tovuq, baliq - eng yaxshi manbalar. üí™";
                } else {
                    return "Muvozanatli ovqatlaning:\n\nü•ó Sabzavot va meva (5 porsiya/kun)\nüçó Protein (tovuq, baliq, tuxum)\nüçö Uglevod (guruch, kartoshka)\nü•ë Foydali yog' (yong'oq, avokado)\n\nShirinlik va fast food kamroq. Ko'p suv iching (2-3 litr/kun)! üíß";
                }
            }
            
            // Nima uchun ozolmayapman
            if (q.includes('ozolmay') || q.includes('semirmay') || (q.includes('nima uchun') && q.includes('yo\'qot'))) {
                return "Vazn yo'qotmaslikning sabablari:\n\n1Ô∏è‚É£ Kaloriya hali ko'p - ovqatni kamaytiring\n2Ô∏è‚É£ Mashq kam - kuniga 45-60 daqiqa kardio qiling\n3Ô∏è‚É£ Uyqu kam - 7-8 soat uxlang\n4Ô∏è‚É£ Stress ko'p - dam oling, meditatsiya qiling\n5Ô∏è‚É£ Suv kam - 2-3 litr suv iching\n6Ô∏è‚É£ Sabr kam - natija 2-3 haftada ko'rinadi\n\nMuntazam bo'ling, natija albatta bo'ladi! üí™";
            }
            
            // Vaqt haqida
            if (q.includes('qancha vaqt') || q.includes('necha soat')) {
                if (goal === 'lose') {
                    return "Vazn yo'qotish uchun:\n\n‚è∞ Kardio: 45-60 daqiqa (kuniga)\n‚è∞ Kuch mashqlari: 30-40 daqiqa (haftada 3-4 kun)\n\nJami: Kuniga 1-1.5 soat mashq qiling. Ertalab och qoringa kardio eng samarali! üèÉ";
                } else if (goal === 'gain' || goal === 'muscle') {
                    return "Mushak qurish uchun:\n\n‚è∞ Og'ir vazn: 60-90 daqiqa (kuniga)\n‚è∞ Kardio: 15-20 daqiqa (haftada 2-3 kun)\n\nKo'p mashq qilmang! Mushak dam olishda o'sadi. Har mushak guruhiga 48 soat dam bering. üí™";
                } else {
                    return "Sog'lom turmush tarzi uchun:\n\n‚è∞ Mashq: 30-45 daqiqa (kuniga)\n‚è∞ Haftada: 4-5 kun\n\nBu yetarli! Muhimi - muntazamlik. Har kuni bir xil vaqtda mashq qiling. ‚è∞";
                }
            }
            
            // Protein haqida
            if (q.includes('protein')) {
                const proteinAmount = weight > 0 ? Math.round(weight * 2) : 140;
                return `Protein miqdori:\n\nüí™ Sizning vazningiz: ${weight}kg\nü•© Kerakli protein: ${proteinAmount}g/kun (2g √ó ${weight}kg)\n\nProtein manbalari:\n‚Ä¢ Tovuq ko'kragi: 100g = 30g protein\n‚Ä¢ Tuxum: 1 dona = 6g protein\n‚Ä¢ Baliq: 100g = 25g protein\n‚Ä¢ Protein shake: 1 porsiya = 25g protein\n\nHar ovqatda 30-40g protein iste'mol qiling! üçó`;
            }
            
            // Suv haqida
            if (q.includes('suv')) {
                return "Suv ichish juda muhim!\n\nüíß Kuniga: 2-3 litr (8-12 stakan)\nüíß Mashqdan oldin: 1-2 stakan\nüíß Mashq paytida: Har 15 daqiqada 1 stakan\nüíß Mashqdan keyin: 2-3 stakan\n\nSuv metabolizmni tezlashtiradi, toksinlarni chiqaradi va energiya beradi. Och qoringa 2 stakan iliq suv iching! üíß";
            }
            
            // Uyqu haqida
            if (q.includes('uyqu') || q.includes('uxla')) {
                return "Uyqu juda muhim!\n\nüò¥ Optimal: 7-8 soat/kecha\nüò¥ Mushak o'sishi: Uyquda sodir bo'ladi\nüò¥ Metabolizm: Yetarli uyqu = tez metabolizm\nüò¥ Energiya: Yaxshi uyqu = ko'p energiya\n\nHar kuni bir xil vaqtda uxlang va turing. Telefonsiz uxlang! üì±‚ùå";
            }
            
            // Maqsad haqida
            if (q.includes('maqsad') || q.includes('natija')) {
                return `Sizning maqsadingiz: ${goal === 'lose' ? 'Vazn yo\'qotish' : goal === 'gain' ? 'Vazn oshirish' : goal === 'muscle' ? 'Mushak qurish' : 'Fit bo\'lish'}\n\nüìä Natija ko'rish uchun:\n‚Ä¢ Muntazam mashq qiling (haftada 4-5 kun)\n‚Ä¢ To'g'ri ovqatlaning\n‚Ä¢ Yetarli uxlang (7-8 soat)\n‚Ä¢ Sabr qiling (2-4 hafta)\n\nHar hafta o'zingizni tortib, o'lcha–± boring. Rasm oling va taqqoslang! üì∏`;
            }
            
            // Motivatsiya
            if (q.includes('motivatsiya') || q.includes('ishtaha') || q.includes('xohish')) {
                return "üí™ MOTIVATSIYA!\n\nüî• Har kuni o'zingizga va'da bering\nüî• Maqsadingizni yozing va ko'ring\nüî• O'zgarishlarni rasm ga oling\nüî• Do'stlaringiz bilan raqobatlashing\nüî• Muvaffaqiyatni nishonlang\n\nEsda tuting: Siz kuchli va qodirsiz! Har bir mashq sizni maqsadga yaqinlashtiradi. Taslim bo'lmang! üí™üî•";
            }
            
            // ===== UNIVERSAL TOPICS =====
            
            // Erta turish
            if (q.includes('erta') && (q.includes('tur') || q.includes('uyg\'on'))) {
                return "üåÖ ERTA TURISH\n\nErta turish uchun:\n\n‚è∞ Har kuni bir xil vaqtda uxlang (22:00-23:00)\nüì± Uxlashdan 1 soat oldin telefon yopma ng\n‚òÄÔ∏è Uyg'onganda darhol parda oching\nüíß 2 stakan suv iching\nüèÉ Ertalab mashq qiling\n\nBudilnikni xonadan uzoqqa qo'ying. Snooze tugmasini bosmang! Erta turish uchun sabab toping - mashq, o'qish, meditatsiya. 21 kun davom eting, odat bo'ladi! üí™";
            }
            
            // Tillochilik / Zargarlik
            if (q.includes('tillo') || q.includes('zargar') || q.includes('jewel')) {
                return "üíé TILLOCHILIK\n\nTillochilikni o'rganish:\n\nüî® Asboblar: Bolg'a, qisqich, payvandlash moslamasi\nüìö Nazariya: Metallar xususiyatlari, dizayn\nüë®‚Äçüè´ Ustoz: Tajribali tillochilardan o'rganing\nüíç Amaliyot: Oddiy loyihalardan boshlang (uzuk, sirg'a)\n\nOnlayn kurslar: YouTube, Skillshare\nKitoblar: Jewelry making asoslari\nAmaliyot: Har kuni 1-2 soat mashq qiling\n\nBu kasb sabr va diqqat talab qiladi. Lekin juda daromadli! üí∞";
            }
            
            // Biznes / Tadbirkorlik
            if (q.includes('biznes') || q.includes('tadbirkorlik') || q.includes('business') || q.includes('startup')) {
                return "üíº BIZNES BOSHLASH\n\nBiznes boshlash qadamlari:\n\nüí° G'oya: Muammoni hal qiling\nüìä Bozor: Mijozlar va raqobatchilarni o'rganing\nüí∞ Moliya: Boshlang'ich kapital (10-50 mln so'm)\nüìà Marketing: Instagram, Telegram, TikTok\nüéØ MVP: Minimal mahsulot yarating\n\nKichikdan boshlang. Mijozlar bilan gaplashing. Moliyani to'g'ri boshqaring. Onlayn mavjudlikni yarating. Hammasi mukammal bo'lishini kutmang - boshlang! üöÄ";
            }
            
            // Ingliz tili
            if (q.includes('ingliz') || q.includes('english') || (q.includes('til') && !q.includes('tillo'))) {
                return "üó£Ô∏è INGLIZ TILI\n\nIngliz tilini o'rganish:\n\nüìö Har kuni 30 daqiqa mashq qiling\nüéß Tinglash: Podcast, film, musiqa\nüó£Ô∏è Gapirish: Tandem, speaking club\nüìñ O'qish: Kitob, maqola, news\n‚úçÔ∏è Yozish: Kundalik, esse\n\nIlovalar: Duolingo, Anki, Memrise\nYouTube: English with Lucy, BBC Learning English\nFilmlar: Subtitr bilan tomosha qiling\n\nHar kuni 10 ta yangi so'z o'rganing. Ingliz tilida o'ylashga harakat qiling. Xatolardan qo'rqmang! üéØ";
            }
            
            // Dasturlash / Coding
            if (q.includes('dastur') || q.includes('kod') || q.includes('programming') || q.includes('python') || q.includes('javascript')) {
                return "üíª DASTURLASH\n\nDasturlashni o'rganish:\n\nüêç Python: Boshlovchilar uchun eng yaxshi\nüåê JavaScript: Web development uchun\nüìö Asoslar: O'zgaruvchilar, funksiyalar, sikllar\nüõ†Ô∏è Loyihalar: O'rgangan narsangizni amalda qo'llang\nüåê GitHub: Portfolio yarating\n\nOnlayn kurslar: Codecademy, freeCodeCamp, Udemy\nAmaliyot: LeetCode, HackerRank\nKitoblar: \"Python Crash Course\", \"Eloquent JavaScript\"\n\nHar kuni kod yozing. Kichik loyihalar yarating. Stack Overflow dan foydalaning. Sabr qiling! üöÄ";
            }
            
            // Pul ishlash / Daromad
            if (q.includes('pul') || q.includes('daromad') || q.includes('ish topish') || q.includes('maosh')) {
                return "üí∞ PUL ISHLASH\n\nOnlayn pul ishlash yo'llari:\n\nüíª Freelance: Upwork, Fiverr, Kwork\nüìù Kontent: Maqola, video, dizayn\nüéì O'qitish: Online darslar, kurslar\nüì± SMM: Instagram, Telegram kanal\nüõçÔ∏è Savdo: Dropshipping, affiliate\n\nKo'nikma o'rganing: Dizayn, dasturlash, video montaj\nPortfolio yarating: Ishlaringizni ko'rsating\nTarmoq quring: LinkedIn, Telegram guruhlar\n\nDastlab kam pul olasiz. Lekin tajriba to'plang, narxni oshiring. Sabr va mehnat! üí™";
            }
            
            // O'qish / Kitob
            if (q.includes('kitob') || q.includes('o\'qish') || q.includes('reading')) {
                return "üìö KITOB O'QISH\n\nKo'proq kitob o'qish uchun:\n\n‚è∞ Har kuni 30 daqiqa o'qing\nüìñ Qiziqarli kitoblardan boshlang\nüéØ Yiliga 12 kitob maqsadi qo'ying (oyiga 1)\nüìù Eslatmalar yozing\nüí° O'qiganni amalda qo'llang\n\nQayerdan boshlash:\n‚Ä¢ Biznes: \"Rich Dad Poor Dad\", \"Atomic Habits\"\n‚Ä¢ Motivatsiya: \"The Power of Now\", \"Think and Grow Rich\"\n‚Ä¢ Badiiy: \"1984\", \"The Alchemist\"\n\nTelefon o'rniga kitob o'qing. Uyqud an oldin o'qing. Kitob - eng yaxshi investitsiya! üìñ";
            }
            
            // Muvaffaqiyat / Success
            if (q.includes('muvaffaqiyat') || q.includes('success') || q.includes('yutuq')) {
                return "üèÜ MUVAFFAQIYAT\n\nMuvaffaqiyatga erishish:\n\nüéØ Aniq maqsad qo'ying\nüìù Reja tuzing va yozing\nüí™ Har kuni harakat qiling\nüìö Doimiy o'rganing\nü§ù To'g'ri odamlar bilan bo'ling\n‚è∞ Vaqtni to'g'ri boshqaring\nüò¥ Sog'lom turmush tarzi\n\nMuvaffaqiyat formulasi:\n= Aniq maqsad + Muntazam harakat + Sabr + O'rganish\n\nTaslim bo'lmang! Har bir muvaffaqiyatsizlik - dars. Kichik yutuqlarni nishonlang. Siz qila olasiz! üí™üî•";
            }
            
            // Vaqtni boshqarish
            if (q.includes('vaqt') && (q.includes('boshqar') || q.includes('manage') || q.includes('yetish'))) {
                return "‚è∞ VAQTNI BOSHQARISH\n\nVaqtni samarali boshqarish:\n\nüìù Reja: Har kuni kechqurun ertangi kun rejasini yozing\nüéØ Prioritet: Eng muhim 3 ta ishni birinchi qiling\n‚è±Ô∏è Pomodoro: 25 daqiqa ish + 5 daqiqa dam\nüì± Telefon: Ijtimoiy tarmoqlarni cheklang\n‚ùå \"Yo'q\" deyishni o'rganing\n\nVaqt o'g'rilari:\n‚Ä¢ Ijtimoiy tarmoqlar (2-3 soat/kun)\n‚Ä¢ Keraksiz uchrashuvlar\n‚Ä¢ Multitasking (samarasiz)\n\nEslab qoling: Vaqt = Hayot. Vaqtni behuda sarflamang! ‚è∞";
            }
            
            // Uylanish / Oila
            if (q.includes('uylan') || q.includes('turmush') || q.includes('oila') || q.includes('nikoh')) {
                return "üíë OILA QURISH\n\nTo'g'ri tanlov qilish:\n\n‚ù§Ô∏è Sevgi va hurmat asosiy\nü§ù Umumiy qadriyatlar va maqsadlar\nüí¨ Ochiq muloqot\nüôè Din va axloq\nüë®‚Äçüë©‚Äçüëß Oila bilan tanishing\n‚è∞ Shoshilmang, vaqt bering\n\nMuhim savollar:\n‚Ä¢ Hayotdan nima kutasiz?\n‚Ä¢ Bolalar haqida fikringiz?\n‚Ä¢ Moliyaviy rejalaringiz?\n‚Ä¢ Muammolarni qanday hal qilasiz?\n\nOila - hayotning eng muhim qaror i. Diqqat bilan tanla ng. Duolar qiling! ü§≤";
            }
            
            // Sog'liq / Salomatlik
            if (q.includes('sog\'liq') || q.includes('salomatlik') || q.includes('health') || q.includes('kasallik')) {
                return "üè• SOG'LIQ\n\nSog'lom turmush tarzi:\n\nü•ó Ovqatlanish: Muvozanatli, tabiiy ovqatlar\nüí™ Harakat: Kuniga 30 daqiqa mashq\nüò¥ Uyqu: 7-8 soat\nüíß Suv: 2-3 litr/kun\nüßò Stress: Meditatsiya, dam olish\nüö≠ Yomon odatlar: Chekish, alkogol - YO'Q\n\nProfilaktika:\n‚Ä¢ Yiliga 1 marta tekshiruv\n‚Ä¢ Vitaminlar (D, C, B12)\n‚Ä¢ Tish shifokoriga 6 oyda 1 marta\n\nSog'liq - eng katta boylik. Bugundan boshlang! üíö";
            }
            
            // Depressiya / Stress
            if (q.includes('depressiya') || q.includes('stress') || q.includes('tushkunlik') || q.includes('qayg\'u')) {
                return "üß† RUHIY SALOMATLIK\n\nStress va depressiyadan qutulish:\n\nüßò Meditatsiya: Kuniga 10 daqiqa\nüèÉ Jismoniy faollik: Endorfin ishlab chiqaradi\nüò¥ Yetarli uyqu: 7-8 soat\nüí¨ Gaplashing: Yaqinlaringiz bilan\nüìù Yozing: Kundalik yuring\nüå≥ Tabiat: Tashqarida vaqt o'tkazing\nüôè Ibodat: Ruhiy tinchlik\n\n‚ö†Ô∏è MUHIM: Agar jiddiy muammo bo'lsa, psixolog bilan maslahatlashing!\n\nEsda tuting: Bu vaqtinchalik. Siz yolg'iz emassiz. Yordam so'rang! üíö";
            }
            
            // Ota-ona / Tarbiya
            if (q.includes('bola') || q.includes('tarbiya') || q.includes('ota-ona') || q.includes('parenting')) {
                return "üë∂ BOLALAR TARBIYASI\n\nYaxshi tarbiya asoslari:\n\n‚ù§Ô∏è Sevgi va e'tibor: Har kuni sifatli vaqt o'tkazing\nüìö O'qish: Bolaga kitob o'qib bering\nüéØ Namuna: O'zingiz yaxshi namuna bo'ling\nüí¨ Tinglang: Bolangiz gapini tinglang\nüé® Ijodkorlik: Rasm, musiqa, sport\nüì± Texnologiya: Cheklang, nazorat qiling\nüôè Qadriyatlar: Din, axloq o'rgating\n\nJazolash o'rniga tushuntiring. Maqtang, rag'batlantiring. Sabr qiling. Bolalar - amanat! üë®‚Äçüë©‚Äçüëß‚Äçüë¶";
            }
            
            // Default response - UNIVERSAL
            return "ü§ñ Savolingizga javob:\n\nMen har qanday mavzuda yordam bera olaman:\n\nüí™ Sport va fitness\nüíº Biznes va tadbirkorlik\nüìö Ta'lim va o'rganish\nüí∞ Pul ishlash\n‚ù§Ô∏è Munosabatlar va oila\nüè• Sog'liq va salomatlik\nüß† Shaxsiy rivojlanish\n‚è∞ Vaqtni boshqarish\nüéØ Maqsad va motivatsiya\n\nSavolingizni aniqroq yozing, men batafsil javob beraman! üí¨\n\nMasalan:\n‚Ä¢ \"Qanday biznes boshlash mumkin?\"\n‚Ä¢ \"Ingliz tilini qanday o'rganish kerak?\"\n‚Ä¢ \"Erta turishni qanday odat qilish mumkin?\"\n‚Ä¢ \"Pul ishlashning qanday yo'llari bor?\"";
        }

        // Video Advice Functions
        let videoHistory = [];
        let currentVideoIndex = 0;
        let currentVideos = [];

        function askVideoQuestion(question) {
            document.getElementById('video-question-input').value = question;
            askVideoAdvice();
        }

        function askVideoAdvice() {
            const question = document.getElementById('video-question-input').value.trim();
            if (!question) {
                alert('Iltimos, savolingizni yozing!');
                return;
            }
            
            // Get AI response and videos
            const response = getVideoAdviceResponse(question);
            
            // Show response section
            document.getElementById('video-response-section').classList.remove('hidden');
            document.getElementById('video-history-section').classList.remove('hidden');
            
            // Display AI explanation
            document.getElementById('video-ai-explanation').innerHTML = response.explanation;
            
            // Display video
            currentVideos = response.videos;
            currentVideoIndex = 0;
            displayCurrentVideo();
            
            // Display additional tips
            document.getElementById('video-additional-tips').innerHTML = response.tips;
            
            // Add to history
            videoHistory.unshift({
                question: question,
                date: new Date().toLocaleDateString('uz-UZ')
            });
            if (videoHistory.length > 5) videoHistory.pop();
            updateVideoHistory();
            
            // Clear input
            document.getElementById('video-question-input').value = '';
            
            // Scroll to response
            document.getElementById('video-response-section').scrollIntoView({ behavior: 'smooth' });
        }

        function displayCurrentVideo() {
            if (currentVideos.length === 0) return;
            
            const video = currentVideos[currentVideoIndex];
            document.getElementById('video-player-iframe').src = video.url;
            document.getElementById('video-title').textContent = video.title;
        }

        function changeVideo() {
            if (currentVideos.length === 0) return;
            
            currentVideoIndex = (currentVideoIndex + 1) % currentVideos.length;
            displayCurrentVideo();
        }

        function updateVideoHistory() {
            const historyDiv = document.getElementById('video-history-list');
            historyDiv.innerHTML = videoHistory.map(item => `
                <div style="background: #0a0e27; border: 2px solid #0f3460; border-radius: 8px; padding: 15px; margin-bottom: 10px; cursor: pointer;" onclick="askVideoQuestion('${item.question.replace(/'/g, "\\'")}')">
                    <div style="color: #00d4ff; font-weight: bold; margin-bottom: 5px;">${item.question}</div>
                    <div style="color: #aaa; font-size: 12px;">${item.date}</div>
                </div>
            `).join('');
        }

        function getVideoAdviceResponse(question) {
            const q = question.toLowerCase();
            
            // Universal video search - har qanday mavzu uchun
            // YouTube qidiruv havolasini yaratamiz
            const searchQuery = encodeURIComponent(question + " o'zbek tilida");
            const youtubeSearchUrl = `https://www.youtube.com/results?search_query=${searchQuery}`;
            
            return {
                explanation: `<p><strong>Sizning savolingiz:</strong> "${question}"</p>
                    <p style="margin-top: 15px;">Quyida ushbu mavzu bo'yicha foydali videolar:</p>
                    <p style="margin-top: 10px; padding: 15px; background: #0a0e27; border-left: 4px solid #00d4ff; border-radius: 4px;">
                        üí° <strong>Maslahat:</strong> Videolarni to'liq ko'ring va amaliyotda qo'llang. Savollar bo'lsa, AI SUHBAT bo'limida so'rang!
                    </p>`,
                videos: [
                    { url: `https://www.youtube.com/embed/search?q=${searchQuery}`, title: `${question} - Video 1` },
                    { url: `https://www.youtube.com/embed/search?q=${searchQuery}`, title: `${question} - Video 2` },
                    { url: `https://www.youtube.com/embed/search?q=${searchQuery}`, title: `${question} - Video 3` }
                ],
                tips: `<div style="margin-top: 20px; padding: 20px; background: linear-gradient(135deg, #0f3460 0%, #16213e 100%); border: 2px solid #00d4ff; border-radius: 8px;">
                    <h4 style="color: #00d4ff; margin-bottom: 15px;">üì∫ YouTube'da qidirish:</h4>
                    <p style="margin-bottom: 15px;">Quyidagi havoladan YouTube'da to'g'ridan-to'g'ri qidirishingiz mumkin:</p>
                    <a href="${youtubeSearchUrl}" target="_blank" style="display: inline-block; background: #ff0000; color: #fff; padding: 12px 24px; border-radius: 6px; text-decoration: none; font-weight: bold;">
                        ‚ñ∂Ô∏è YouTube'da Qidirish
                    </a>
                    <p style="margin-top: 15px; font-size: 13px; color: #aaa;">
                        Qidiruv so'zi: "${question} o'zbek tilida"
                    </p>
                </div>
                <ul style="margin-top: 20px; margin-left: 20px;">
                    <li>‚úÖ Videolarni diqqat bilan tomosha qiling</li>
                    <li>‚úÖ Muhim qismlarni qayta ko'ring</li>
                    <li>‚úÖ Amaliyotda qo'llang</li>
                    <li>‚úÖ Savollar bo'lsa, AI SUHBAT bo'limida so'rang</li>
                    <li>‚úÖ Natijalaringizni kuzatib boring</li>
                </ul>`
            };
        }

        // Admin Functions
        async function showAdminLoginDirect() {
            console.log('Admin login button clicked!');
            // Show custom modal instead of prompt
            const modal = document.getElementById('admin-login-modal');
            const input = document.getElementById('admin-password-input');
                            <li>üçó <strong>Protein</strong>: Har kg vazn uchun 2g protein (masalan, 70kg = 140g)</li>
                            <li>üò¥ <strong>Dam olish</strong>: Mushak uyquda o'sadi, 8 soat uxlang</li>
                        </ul>
                        <p style="margin-top: 10px;">Quyidagi videolarda professional murabbiylar batafsil tushuntiradi!</p>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/IODxDxX7oi4', title: 'Push Day - Ko\'krak, Yelka, Triceps' },
                        { url: 'https://www.youtube.com/embed/eE7P4EEhbP8', title: 'Pull Day - Orqa, Biceps' },
                        { url: 'https://www.youtube.com/embed/gcNh17Ckjgg', title: 'Leg Day - Oyoqlar' }
                    ],
                    tips: `<ul style="margin-left: 20px;">
                        <li>‚úÖ Har mashqni to'g'ri texnika bilan qiling</li>
                        <li>‚úÖ Progressiv overload - har hafta vazn oshiring</li>
                        <li>‚úÖ Creatine va protein qabul qiling</li>
                        <li>‚úÖ Har mushak guruhiga 48 soat dam bering</li>
                        <li>‚ùå Overtraining qilmang - ko'p mashq zarar</li>
                    </ul>`
                };
            }
            
            // Erta turish
            if (q.includes('erta') && (q.includes('tur') || q.includes('uyg\'on'))) {
                return {
                    explanation: `<p><strong>Erta turish</strong> - muvaffaqiyatli odamlarning odati. Qanday o'rganish mumkin:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>‚è∞ <strong>Muntazam uxlash</strong>: Har kuni bir xil vaqtda uxlang (22:00-23:00)</li>
                            <li>üì± <strong>Telefonsiz</strong>: Uxlashdan 1 soat oldin telefon yopmang</li>
                            <li>‚òÄÔ∏è <strong>Quyosh nuri</strong>: Uyg'onganda darhol parda oching</li>
                            <li>üíß <strong>Suv iching</strong>: Uyg'onib 2 stakan suv iching</li>
                        </ul>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/Lb3yJ_4ZqiQ', title: 'Erta Turish Odatini Qanday Shakllantirish' },
                        { url: 'https://www.youtube.com/embed/aXvDEmo6uS4', title: '5 AM Club - Erta Turish Qoidalari' },
                        { url: 'https://www.youtube.com/embed/JiT3KHGK_78', title: 'Uyqu Sifatini Yaxshilash' }
                    ],
                    tips: `<ul style="margin-left: 20px;">
                        <li>‚úÖ Budilnik xonadan uzoqqa qo'ying</li>
                        <li>‚úÖ Erta turish uchun sabab toping (mashq, o'qish)</li>
                        <li>‚úÖ Kechqurun shirinlik yemang</li>
                        <li>‚úÖ Xonani salqin saqlang (18-20¬∞C)</li>
                        <li>‚ùå Snooze tugmasini bosmang!</li>
                    </ul>`
                };
            }
            
            // Tillochilik / Adjim
            if (q.includes('tillo') || q.includes('zargar') || q.includes('jewel') || q.includes('adjim')) {
                return {
                    explanation: `<p><strong>Tillochilik (Adjim)</strong> - qadimiy va daromadli kasb. O'rganish uchun:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üî® <strong>Asboblar</strong>: Bolg'a, qisqich, payvandlash moslamasi</li>
                            <li>üìö <strong>Nazariya</strong>: Metallar xususiyatlari, dizayn asoslari</li>
                            <li>üë®‚Äçüè´ <strong>Ustoz</strong>: Tajribali tillochilardan o'rganing</li>
                            <li>üíé <strong>Amaliyot</strong>: Oddiy loyihalardan boshlang</li>
                        </ul>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/dQw4w9WgXcQ', title: 'Tillochilik Asoslari - O\'zbek tilida' },
                        { url: 'https://www.youtube.com/embed/dQw4w9WgXcQ', title: 'Zargarlik Asboblari va Texnikalar' },
                        { url: 'https://www.youtube.com/embed/dQw4w9WgXcQ', title: 'Uzuk Yasash - Qadam-baqadam' }
                    ],
                    tips: `<ul style="margin-left:20px;">
                        <li>‚úÖ Oddiy loyihalardan boshlang (uzuk, sirg'a)</li>
                        <li>‚úÖ Sifatli asboblar sotib oling</li>
                        <li>‚úÖ Xavfsizlik qoidalariga rioya qiling</li>
                        <li>‚úÖ Dizayn ko'nikmalarini rivojlantiring</li>
                        <li>‚úÖ Bozorni o'rganing - nima sotiladi</li>
                        <li>‚úÖ Ustoz topib, amaliy o\'rganing</li>
                        <li>‚úÖ Sabr qiling - mahorat vaqt talab qiladi</li>
                    </ul>`
                };
            }
            
            // Biznes
            if (q.includes('biznes') || q.includes('tadbirkorlik') || q.includes('business')) {
                return {
                    explanation: `<p><strong>Biznes boshlash</strong> - qiyin lekin foydali yo'l. Qadamlar:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üí° <strong>G'oya</strong>: Muammoni hal qiladigan g'oya toping</li>
                            <li>üìä <strong>Bozor tahlili</strong>: Mijozlar va raqobatchilarni o'rganing</li>
                            <li>üí∞ <strong>Moliya</strong>: Boshlang'ich kapital va xarajatlar</li>
                            <li>üìà <strong>Marketing</strong>: Mijozlarni qanday topish</li>
                        </ul>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/ZoqgAy3h4OM', title: 'Biznes Qanday Boshlanadi - To\'liq Qo\'llanma' },
                        { url: 'https://www.youtube.com/embed/jpe-LKn-4gM', title: 'Kichik Biznes G\'oyalari' },
                        { url: 'https://www.youtube.com/embed/llKvV8_T95M', title: 'Marketing Asoslari' }
                    ],
                    tips: `<ul style="margin-left: 20px;">
                        <li>‚úÖ Kichikdan boshlang - MVP yarating</li>
                        <li>‚úÖ Mijozlar bilan gaplashing</li>
                        <li>‚úÖ Moliyani to'g'ri boshqaring</li>
                        <li>‚úÖ Onlayn mavjudlikni yarating</li>
                        <li>‚ùå Hammasi mukammal bo'lishini kutmang</li>
                    </ul>`
                };
            }
            
            // Ingliz tili
            if (q.includes('ingliz') || q.includes('english') || q.includes('til')) {
                return {
                    explanation: `<p><strong>Ingliz tilini o'rganish</strong> - zamonaviy dunyo uchun zarur. Samarali usullar:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üìö <strong>Har kuni</strong>: 30 daqiqa muntazam mashq qiling</li>
                            <li>üéß <strong>Tinglash</strong>: Podcast, film, musiqa</li>
                            <li>üó£Ô∏è <strong>Gapirish</strong>: Tandem, speaking club</li>
                            <li>üìñ <strong>O'qish</strong>: Kitob, maqola, news</li>
                        </ul>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/illApgaLgGA', title: 'Ingliz Tilini Qanday O\'rganish - Samarali Usullar' },
                        { url: 'https://www.youtube.com/embed/d0yGdNEWdn0', title: 'Speaking Skills - Gapirish Ko\'nikmalari' },
                        { url: 'https://www.youtube.com/embed/WQGtcxkMm8M', title: 'Grammar Asoslari' }
                    ],
                    tips: `<ul style="margin-left: 20px;">
                        <li>‚úÖ Har kuni 10 ta yangi so'z o'rganing</li>
                        <li>‚úÖ Ingliz tilida o'ylashga harakat qiling</li>
                        <li>‚úÖ Xatolardan qo'rqmang - amaliyot muhim</li>
                        <li>‚úÖ Duolingo, Anki kabi ilovalardan foydalaning</li>
                        <li>‚úÖ Ingliz tilida film va serial tomosha qiling</li>
                    </ul>`
                };
            }
            
            // Dasturlash
            if (q.includes('dastur') || q.includes('kod') || q.includes('programming')) {
                return {
                    explanation: `<p><strong>Dasturlashni o'rganish</strong> - kelajak kasbi. Qayerdan boshlash:</p>
                        <ul style="margin-left: 20px; margin-top: 10px;">
                            <li>üíª <strong>Til tanlash</strong>: Python (boshlovchilar uchun) yoki JavaScript (web)</li>
                            <li>üìö <strong>Asoslar</strong>: O'zgaruvchilar, funksiyalar, sikllar</li>
                            <li>üõ†Ô∏è <strong>Loyihalar</strong>: O'rgangan narsangizni amalda qo'llang</li>
                            <li>üåê <strong>Portfolio</strong>: GitHub da loyihalar joylashtiring</li>
                        </ul>`,
                    videos: [
                        { url: 'https://www.youtube.com/embed/_uQrJ0TkZlc', title: 'Python - Boshlovchilar Uchun To\'liq Kurs' },
                        { url: 'https://www.youtube.com/embed/PkZNo7MFNFg', title: 'JavaScript - Asoslar' },
                        { url: 'https://www.youtube.com/embed/UB1O30fR-EE', title: 'Web Development - HTML, CSS, JS' }
                    ],
                    tips: `<ul style="margin-left: 20px;">
                        <li>‚úÖ Har kuni kod yozing - amaliyot muhim</li>
                        <li>‚úÖ LeetCode, HackerRank da mashq qiling</li>
                        <li>‚úÖ Open source loyihalarga qo'shiling</li>
                        <li>‚úÖ Stack Overflow dan foydalaning</li>
                        <li>‚úÖ Kichik loyihalar yarating va GitHub ga yuklang</li>
                    </ul>`
                };
            }
            
            // Default response
            return {
                explanation: `<p>Savolingiz uchun umumiy maslahat:</p>
                    <p style="margin-top: 10px;">Har qanday ko'nikmani o'rganish uchun:</p>
                    <ul style="margin-left: 20px; margin-top: 10px;">
                        <li>üìö <strong>O'rganing</strong>: Kitob, video, kurs</li>
                        <li>üí™ <strong>Amaliyot</strong>: Har kuni mashq qiling</li>
                        <li>üë®‚Äçüè´ <strong>Ustoz</strong>: Tajribali odamlardan o'rganing</li>
                        <li>üéØ <strong>Maqsad</strong>: Aniq maqsad qo'ying</li>
                        <li>‚è∞ <strong>Vaqt</strong>: Sabr qiling, natija vaqt talab qiladi</li>
                    </ul>`,
                videos: [
                    { url: 'https://www.youtube.com/embed/TQMbvJNRpLE', title: 'Qanday Tez O\'rganish Mumkin' },
                    { url: 'https://www.youtube.com/embed/5MgBikgcWnY', title: 'Muvaffaqiyat Qoidalari' },
                    { url: 'https://www.youtube.com/embed/arj7oStGLkU', title: 'Motivatsiya va Maqsad' }
                ],
                tips: `<ul style="margin-left: 20px;">
                    <li>‚úÖ Muntazam bo'ling - har kuni bir oz</li>
                    <li>‚úÖ Xatolardan o'rganing</li>
                    <li>‚úÖ Jamoada ishlang</li>
                    <li>‚úÖ O'z natijalaringizni kuzating</li>
                    <li>‚úÖ Hech qachon taslim bo'lmang!</li>
                </ul>`
            };
        }

        // Admin Functions
        async function showAdminLoginDirect() {
            console.log('Admin login button clicked!');
            // Show custom modal instead of prompt
            const modal = document.getElementById('admin-login-modal');
            const input = document.getElementById('admin-password-input');
            
            modal.classList.remove('hidden');
            input.value = ''; // Clear value
            
            // Clear again after a small delay (for browser autocomplete)
            setTimeout(() => {
                input.value = '';
                input.focus();
            }, 100);
        }
        
        function showAdminLogin() {
            const modal = document.getElementById('admin-login-modal');
            const input = document.getElementById('admin-password-input');
            
            modal.classList.remove('hidden');
            input.value = '';
            
            setTimeout(() => {
                input.value = '';
                input.focus();
            }, 100);
        }

        function closeAdminLogin() {
            document.getElementById('admin-login-modal').classList.add('hidden');
            document.getElementById('admin-password-input').value = '';
        }

        async function checkAdminPassword() {
            const password = document.getElementById('admin-password-input').value.trim();
            
            if (password === ADMIN_PASSWORD) {
                console.log('Password correct! Logging in as admin...');
                isAdmin = true;
                closeAdminLogin();
                
                // Check if we're on login screen or main screen
                const isLoginScreen = !document.getElementById('login-screen').classList.contains('hidden');
                
                if (isLoginScreen) {
                    // Coming from login screen - go directly to admin panel
                    db.setUser('998918235858');
                    userData = {
                        name: 'Admin',
                        phone: '998918235858',
                        pass: ADMIN_PASSWORD,
                        approved: true,
                        schedule: {},
                        morning: [],
                        evening: [],
                        goals: [],
                        foods: [],
                        settings: { age: 0, height: 0, weight: 0, goal: '', workoutMode: '2', workoutTimeChoice: 'both', morningTime: '06:00', eveningTime: '18:00', morningSport: '', eveningSport: '' }
                    };
                    
                    // Show main screen
                    document.getElementById('login-screen').classList.add('hidden');
                    document.getElementById('main-screen').classList.remove('hidden');
                    
                    // Show admin menu button
                    document.getElementById('admin-menu-btn').style.display = 'block';
                    
                    updateUserDisplay();
                    
                    // Go directly to admin panel
                    switchTab('admin');
                    updatePageTitle('admin');
                    
                    // Load admin users
                    await loadAdminUsers();
                } else {
                    // Coming from sidebar - just open admin panel
                    switchTab('admin');
                    await loadAdminUsers();
                }
            } else {
                alert('Noto\'g\'ri parol!');
                document.getElementById('admin-password-input').value = '';
                document.getElementById('admin-password-input').focus();
            }
        }

        async function loadAdminUsers() {
            console.log('=== loadAdminUsers START ===');
            
            // First, always check LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            console.log('LocalStorage RAW data:', localData);
            console.log('LocalStorage keys:', Object.keys(localData));
            
            let users = [];
            
            // Try MongoDB first
            try {
                const response = await fetch('/api/admin/users', {
                    method: 'GET',
                    headers: { 'Content-Type': 'application/json' }
                });
                const result = await response.json();
                console.log('MongoDB response:', result);
                
                if (result.success && result.users && result.users.length > 0) {
                    users = result.users;
                    console.log('Using MongoDB users:', users);
                    displayAdminUsers(users);
                    return;
                }
            } catch (err) {
                console.log('MongoDB error:', err);
            }
            
            // Fallback to LocalStorage
            console.log('Using LocalStorage fallback');
            users = Object.values(localData);
            console.log('All LocalStorage users:', users);
            
            // Filter out admin
            users = users.filter(u => u.phone && u.phone !== '998918235858');
            console.log('Filtered users (no admin):', users);
            
            console.log('=== loadAdminUsers END ===');
            displayAdminUsers(users);
        }
        
        function displayAdminUsers(users) {
            console.log('displayAdminUsers called with:', users);
            
            // Calculate subscription stats
            const now = new Date();
            let expiredCount = 0;
            let expiringCount = 0;
            
            users.forEach(user => {
                if (user.subscriptionExpiry) {
                    const expiry = new Date(user.subscriptionExpiry);
                    const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysLeft <= 0) {
                        expiredCount++;
                    } else if (daysLeft <= 5) {
                        expiringCount++;
                    }
                }
            });
            
            // Statistika
            const totalUsers = users.length;
            const pendingUsers = users.filter(u => !u.approved).length;
            const approvedUsers = users.filter(u => u.approved).length;
            
            console.log('Stats - Total:', totalUsers, 'Pending:', pendingUsers, 'Approved:', approvedUsers);
            console.log('Subscription - Expired:', expiredCount, 'Expiring:', expiringCount);
            
            document.getElementById('admin-total-users').textContent = totalUsers;
            document.getElementById('admin-pending-users').textContent = pendingUsers;
            document.getElementById('admin-approved-users').textContent = approvedUsers;
            document.getElementById('admin-expired-users').textContent = expiredCount;
            document.getElementById('admin-expiring-users').textContent = expiringCount;
            
            // Foydalanuvchilar ro'yxati
            const usersList = document.getElementById('admin-users-list');
            
            if (users.length === 0) {
                usersList.innerHTML = '<div style="text-align: center; color: #aaa; padding: 20px;">Foydalanuvchilar yo\'q</div>';
                return;
            }
            
            // Sort: expired first, then expiring, then pending, then approved
            users.sort((a, b) => {
                const aExpiry = a.subscriptionExpiry ? new Date(a.subscriptionExpiry) : null;
                const bExpiry = b.subscriptionExpiry ? new Date(b.subscriptionExpiry) : null;
                const aDaysLeft = aExpiry ? Math.ceil((aExpiry - now) / (1000 * 60 * 60 * 24)) : 999;
                const bDaysLeft = bExpiry ? Math.ceil((bExpiry - now) / (1000 * 60 * 60 * 24)) : 999;
                
                // Expired first
                if (aDaysLeft <= 0 && bDaysLeft > 0) return -1;
                if (bDaysLeft <= 0 && aDaysLeft > 0) return 1;
                
                // Then expiring soon
                if (aDaysLeft <= 5 && bDaysLeft > 5) return -1;
                if (bDaysLeft <= 5 && aDaysLeft > 5) return 1;
                
                // Then pending
                if (!a.approved && b.approved) return -1;
                if (!b.approved && a.approved) return 1;
                
                return 0;
            });
            
            usersList.innerHTML = users.map(user => {
                const statusColor = user.approved ? '#00ff88' : '#ffa500';
                const statusText = user.approved ? '‚úÖ Tasdiqlangan' : '‚è≥ Kutayotgan';
                const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('uz-UZ') : 'Noma\'lum';
                
                // Subscription info
                let subscriptionInfo = '';
                let subscriptionColor = '#00ff88';
                if (user.subscriptionExpiry) {
                    const expiry = new Date(user.subscriptionExpiry);
                    const daysLeft = Math.ceil((expiry - now) / (1000 * 60 * 60 * 24));
                    
                    if (daysLeft <= 0) {
                        subscriptionColor = '#ff0055';
                        subscriptionInfo = `<div style="color: ${subscriptionColor}; font-size: 14px; font-weight: bold; margin-top: 5px;">
                            üîî Oylik ${Math.abs(daysLeft)} kun oldin tugagan!
                        </div>`;
                    } else if (daysLeft <= 5) {
                        subscriptionColor = '#ffa500';
                        subscriptionInfo = `<div style="color: ${subscriptionColor}; font-size: 14px; font-weight: bold; margin-top: 5px;">
                            ‚ö†Ô∏è Oylik ${daysLeft} kun ichida tugaydi
                        </div>`;
                    } else {
                        subscriptionInfo = `<div style="color: ${subscriptionColor}; font-size: 13px; margin-top: 5px;">
                            ‚úÖ Oylik: ${daysLeft} kun qoldi
                        </div>`;
                    }
                }
                
                return `
                    <div style="background: #0a0e27; border: 2px solid ${subscriptionColor}; border-radius: 8px; padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 10px;">
                            <div style="flex: 1;">
                                <div style="color: #00d4ff; font-weight: bold; font-size: 18px; margin-bottom: 5px;">
                                    ${user.name || 'Foydalanuvchi'}
                                </div>
                                <div style="color: #aaa; font-size: 14px; margin-bottom: 3px;">
                                    üì± ${user.phone}
                                </div>
                                <div style="color: #aaa; font-size: 12px; margin-bottom: 3px;">
                                    üìÖ Ro'yxatdan o'tgan: ${createdDate}
                                </div>
                                <div style="color: ${statusColor}; font-size: 14px; font-weight: bold;">
                                    ${statusText}
                                </div>
                                ${subscriptionInfo}
                            </div>
                        </div>
                        
                        <!-- Action buttons -->
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 8px;">
                            <button class="admin-btn-view" data-phone="${user.phone}" style="background: #00d4ff; color: #0a0e27; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                üëÅÔ∏è Ko'rish
                            </button>
                            ${!user.approved ? `
                                <button class="admin-btn-approve" data-phone="${user.phone}" style="background: #00ff88; color: #0a0e27; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                    ‚úÖ Tasdiqlash
                                </button>
                                <button class="admin-btn-reject" data-phone="${user.phone}" style="background: #ff0055; color: #fff; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                    ‚ùå Rad etish
                                </button>
                            ` : `
                                <button class="admin-btn-extend" data-phone="${user.phone}" style="background: #00ff88; color: #0a0e27; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                    ‚ûï Oylik Uzaytirish
                                </button>
                                <button class="admin-btn-remove" data-phone="${user.phone}" style="background: #ff0055; color: #fff; border: none; padding: 10px; border-radius: 6px; cursor: pointer; font-weight: bold; font-size: 13px;">
                                    üóëÔ∏è O'chirish
                                </button>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
            
            // Add event listeners
            document.querySelectorAll('.admin-btn-view').forEach(btn => {
                btn.addEventListener('click', () => viewUserDetails(btn.dataset.phone));
            });
            
            document.querySelectorAll('.admin-btn-approve').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('Approve button clicked for:', btn.dataset.phone);
                    approveUser(btn.dataset.phone);
                });
            });
            
            document.querySelectorAll('.admin-btn-reject').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('Reject button clicked for:', btn.dataset.phone);
                    rejectUser(btn.dataset.phone);
                });
            });
            
            document.querySelectorAll('.admin-btn-extend').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('Extend subscription button clicked for:', btn.dataset.phone);
                    extendSubscription(btn.dataset.phone);
                });
            });
            
            document.querySelectorAll('.admin-btn-remove').forEach(btn => {
                btn.addEventListener('click', () => {
                    console.log('Remove button clicked for:', btn.dataset.phone);
                    removeUser(btn.dataset.phone);
                });
            });
        }
        
        // View user details
        async function viewUserDetails(phone) {
            console.log('Viewing user:', phone);
            
            // Try to get from LocalStorage first
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            let user = localData[phone];
            
            if (!user) {
                // Try MongoDB
                try {
                    const response = await fetch(`/api/user/${phone}`);
                    const result = await response.json();
                    if (result.success) {
                        user = result.user;
                    }
                } catch (err) {
                    console.error('Error fetching user:', err);
                }
            }
            
            if (!user) {
                alert('Foydalanuvchi topilmadi!');
                return;
            }
            
            // Display user details in a modal
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 3000; display: flex; align-items: center; justify-content: center; overflow-y: auto; padding: 20px;';
            
            const settings = user.settings || {};
            const createdDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('uz-UZ') : 'Noma\'lum';
            const statusColor = user.approved ? '#00ff88' : '#ffa500';
            const statusText = user.approved ? '‚úÖ Tasdiqlangan' : '‚è≥ Kutayotgan';
            
            modal.innerHTML = `
                <div style="background: #16213e; border: 2px solid #00d4ff; border-radius: 12px; padding: 30px; max-width: 600px; width: 100%; max-height: 90vh; overflow-y: auto;">
                    <h2 style="color: #00d4ff; margin-bottom: 20px; text-align: center;">üë§ FOYDALANUVCHI MA'LUMOTLARI</h2>
                    
                    <div style="background: #0a0e27; border: 2px solid ${statusColor}; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <div style="color: #00d4ff; font-weight: bold; font-size: 20px; margin-bottom: 10px;">
                            ${user.name || 'Foydalanuvchi'}
                        </div>
                        <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">
                            üì± Telefon: ${user.phone}
                        </div>
                        <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">
                            üîë Kod: ${user.pass}
                        </div>
                        <div style="color: #aaa; font-size: 14px; margin-bottom: 5px;">
                            üìÖ Ro'yxatdan o'tgan: ${createdDate}
                        </div>
                        <div style="color: ${statusColor}; font-size: 16px; font-weight: bold; margin-top: 10px;">
                            ${statusText}
                        </div>
                    </div>
                    
                    <div style="background: #0a0e27; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">‚öôÔ∏è Sozlamalar</h3>
                        <div style="color: #aaa; font-size: 14px; line-height: 1.8;">
                            ${settings.age ? `<div>üéÇ Yosh: ${settings.age}</div>` : ''}
                            ${settings.weight ? `<div>‚öñÔ∏è Vazn: ${settings.weight} kg</div>` : ''}
                            ${settings.goal ? `<div>üéØ Maqsad: ${settings.goal}</div>` : ''}
                            ${settings.workoutMode ? `<div>üí™ Mashq rejimi: ${settings.workoutMode}</div>` : ''}
                            ${!settings.age && !settings.height && !settings.weight ? '<div style="color: #666;">Sozlamalar to\'ldirilmagan</div>' : ''}
                        </div>
                    </div>
                    
                    <div style="background: #0a0e27; border: 2px solid #0f3460; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #00d4ff; margin-bottom: 15px;">üìä Statistika</h3>
                        <div style="color: #aaa; font-size: 14px; line-height: 1.8;">
                            <div>üìÖ Jadval: ${user.schedule ? Object.keys(user.schedule).length : 0} kun</div>
                            <div>üåÖ Ertalabki mashqlar: ${user.morning ? user.morning.length : 0} ta</div>
                            <div>üåÜ Kechki mashqlar: ${user.evening ? user.evening.length : 0} ta</div>
                            <div>üéØ Maqsadlar: ${user.goals ? user.goals.length : 0} ta</div>
                            <div>üçΩÔ∏è Ovqatlar: ${user.foods ? user.foods.length : 0} ta</div>
                        </div>
                    </div>
                    
                    <button onclick="this.parentElement.parentElement.remove()" class="btn" style="width: 100%; background: #ff0055;">
                        YOPISH
                    </button>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }

        async function approveUser(phone) {
            if (!confirm('Foydalanuvchini tasdiqlaysizmi?')) return;
            
            try {
                const response = await fetch('/api/admin/approve', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, approved: true })
                });
                const result = await response.json();
                
                if (result.success) {
                    // Also update LocalStorage
                    const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
                    if (localData[phone]) {
                        localData[phone].approved = true;
                        localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                    }
                    
                    alert('Foydalanuvchi tasdiqlandi!');
                    await loadAdminUsers();
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            if (localData[phone]) {
                localData[phone].approved = true;
                localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                alert('Foydalanuvchi tasdiqlandi!');
                await loadAdminUsers();
            } else {
                alert('Foydalanuvchi topilmadi!');
            }
        }

        async function rejectUser(phone) {
            if (!confirm('Foydalanuvchini rad etasizmi? (Akkaunt o\'chiriladi)')) return;
            
            try {
                const response = await fetch('/api/admin/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const result = await response.json();
                
                if (result.success) {
                    // Also remove from LocalStorage
                    const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
                    delete localData[phone];
                    localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                    
                    alert('Foydalanuvchi rad etildi va o\'chirildi!');
                    await loadAdminUsers();
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            delete localData[phone];
            localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
            alert('Foydalanuvchi rad etildi va o\'chirildi!');
            await loadAdminUsers();
        }

        async function removeUser(phone) {
            if (!confirm('Foydalanuvchini o\'chirasizmi? Bu amalni qaytarib bo\'lmaydi!')) return;
            
            try {
                const response = await fetch('/api/admin/remove', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone })
                });
                const result = await response.json();
                
                if (result.success) {
                    // Also remove from LocalStorage
                    const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
                    delete localData[phone];
                    localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                    
                    alert('Foydalanuvchi o\'chirildi!');
                    await loadAdminUsers();
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            delete localData[phone];
            localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
            alert('Foydalanuvchi o\'chirildi!');
            await loadAdminUsers();
        }
        
        async function extendSubscription(phone) {
            const days = prompt('Necha kun uzaytirmoqchisiz? (30 = 1 oy)', '30');
            if (!days || isNaN(days) || days <= 0) return;
            
            const daysNum = parseInt(days);
            
            try {
                // Try MongoDB first
                const response = await fetch('/api/admin/extend-subscription', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ phone, days: daysNum })
                });
                const result = await response.json();
                
                if (result.success) {
                    // Also update LocalStorage
                    const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
                    if (localData[phone]) {
                        const currentExpiry = localData[phone].subscriptionExpiry ? new Date(localData[phone].subscriptionExpiry) : new Date();
                        const newExpiry = new Date(currentExpiry.getTime() + daysNum * 24 * 60 * 60 * 1000);
                        localData[phone].subscriptionExpiry = newExpiry;
                        localData[phone].subscriptionActive = true;
                        localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                    }
                    
                    alert(`Oylik ${daysNum} kun uzaytirildi!`);
                    await loadAdminUsers();
                    return;
                }
            } catch (err) {
                console.log('MongoDB not available, using LocalStorage');
            }
            
            // Fallback to LocalStorage
            const localData = JSON.parse(localStorage.getItem('nuraziz_local_db') || '{}');
            if (localData[phone]) {
                const currentExpiry = localData[phone].subscriptionExpiry ? new Date(localData[phone].subscriptionExpiry) : new Date();
                const newExpiry = new Date(currentExpiry.getTime() + daysNum * 24 * 60 * 60 * 1000);
                localData[phone].subscriptionExpiry = newExpiry;
                localData[phone].subscriptionActive = true;
                localStorage.setItem('nuraziz_local_db', JSON.stringify(localData));
                alert(`Oylik ${daysNum} kun uzaytirildi!`);
                await loadAdminUsers();
            } else {
                alert('Foydalanuvchi topilmadi!');
            }
        }

        function show() {
            document.getElementById('login-screen').classList.add('hidden');
            document.getElementById('main-screen').classList.remove('hidden');
            
            // Show admin menu button only for admin
            if (isAdmin) {
                document.getElementById('admin-menu-btn').style.display = 'block';
            }
            
            updateUserDisplay();
            updatePageTitle('settings'); // Default title
            update();
        }

        window.addEventListener('load', async function() {
            // Clear all login inputs
            document.getElementById('phone').value = '';
            document.getElementById('pass').value = '';
            
            // Clear all register inputs
            document.getElementById('reg-name').value = '';
            document.getElementById('reg-phone').value = '';
            document.getElementById('reg-pass').value = '';
            document.getElementById('reg-pass2').value = '';
            
            // Har safar kod so'ralsin - auto-login yo'q
            db.clear();
        });

        // ============================================
        // AI GOAL CHAT FUNCTIONS
        // ============================================
        
        function openAIGoalChat() {
            const modal = document.getElementById('ai-chat-modal');
            const messagesDiv = document.getElementById('ai-chat-messages');
            const userInfoDiv = document.getElementById('ai-chat-user-info');
            const input = document.getElementById('ai-chat-input');
            
            // Load chat history from userData
            if (!userData.aiChatHistory) {
                userData.aiChatHistory = [];
            }
            
            // Display user info
            const age = userData.settings?.age || 'Noma\'lum';
            const weight = userData.settings?.weight || 'Noma\'lum';
            const goal = userData.settings?.goal || 'Noma\'lum';
            
            userInfoDiv.innerHTML = `
                <strong>üë§ ${userData.name}</strong> | 
                üéÇ Yosh: ${age} | 
                ‚öñÔ∏è Vazn: ${weight}kg | 
                üéØ Maqsad: ${goal}
            `;
            
            // Display chat history
            displayChatHistory();
            
            // Show modal
            modal.classList.remove('hidden');
            input.value = '';
            input.focus();
            
            // If first time, send welcome message
            if (userData.aiChatHistory.length === 0) {
                setTimeout(() => {
                    addAIMessage(`Salom ${userData.name}! üëã\n\nMen sizning shaxsiy AI murabbiyingizman. Sizning maqsadingiz: "${goal}"\n\nMen quyidagi mavzularda yordam bera olaman:\n\nüí™ Mashq rejasi va texnika\nüçΩÔ∏è Ovqatlanish va kaloriya\nüíä Supplement (Protein, Kreatin, BCAA va h.k.)\n‚öñÔ∏è Vazn yo'qotish/oshirish strategiyasi\nüèãÔ∏è Mushak qurish dasturlari\nüò¥ Dam olish va tiklanish\n\nSavolingizni yozing!`);
                }, 500);
            }
        }
        
        function openAINutritionChat() {
            const modal = document.getElementById('ai-chat-modal');
            const messagesDiv = document.getElementById('ai-chat-messages');
            const userInfoDiv = document.getElementById('ai-chat-user-info');
            const input = document.getElementById('ai-chat-input');
            
            // Load chat history from userData
            if (!userData.aiChatHistory) {
                userData.aiChatHistory = [];
            }
            
            // Display user info
            const age = userData.settings?.age || 'Noma\'lum';
            const weight = userData.settings?.weight || 'Noma\'lum';
            const goal = userData.settings?.goal || 'Noma\'lum';
            
            userInfoDiv.innerHTML = `
                <strong>üë§ ${userData.name}</strong> | 
                üéÇ Yosh: ${age} | 
                ‚öñÔ∏è Vazn: ${weight}kg | 
                üéØ Maqsad: ${goal}
            `;
            
            // Display chat history
            displayChatHistory();
            
            // Show modal
            modal.classList.remove('hidden');
            input.value = '';
            input.focus();
            
            // Send nutrition welcome message
            setTimeout(() => {
                addAIMessage(`Salom ${userData.name}! üçΩÔ∏è\n\nMen sizga ovqatlanish bo'yicha yordam beraman!\n\nSizning ma'lumotlaringiz:\nüéÇ Yosh: ${age}\n‚öñÔ∏è Vazn: ${weight}kg\nüéØ Maqsad: ${goal}\n\nMen quyidagi mavzularda yordam bera olaman:\n\nüçΩÔ∏è Kunlik ovqatlanish rejasi\nüìä Kaloriya va makro hisoblash\nü•ó Foydali ovqatlar\nüö´ Taqiqlangan ovqatlar\nüíä Vitamin va supplement\n‚è∞ Ovqatlanish vaqti\nü•§ Suv rejimi\n\nSavolingizni yozing! Masalan:\n- "Kunlik kaloriyam qancha bo'lishi kerak?"\n- "Protein qanday ovqatlarda ko'p?"\n- "Vazn yo'qotish uchun nima yeysam bo'ladi?"`);
            }, 500);
        }
        
        function closeAIChat() {
            document.getElementById('ai-chat-modal').classList.add('hidden');
        }
        
        function displayChatHistory() {
            const messagesDiv = document.getElementById('ai-chat-messages');
            
            if (!userData.aiChatHistory || userData.aiChatHistory.length === 0) {
                messagesDiv.innerHTML = `
                    <div style="text-align: center; color: #aaa; padding: 20px;">
                        <p style="font-size: 16px; margin-bottom: 10px;">üëã Salom! Men sizning shaxsiy AI murabbiyingizman.</p>
                        <p style="font-size: 14px;">Maqsadingiz, ovqatlanish, mashq, supplement va boshqa savollaringizga javob beraman.</p>
                    </div>
                `;
                return;
            }
            
            messagesDiv.innerHTML = userData.aiChatHistory.map(msg => {
                if (msg.type === 'user') {
                    return `
                        <div style="display: flex; justify-content: flex-end;">
                            <div style="background: linear-gradient(135deg, #00d4ff, #00ff88); color: #0a0e27; padding: 12px 16px; border-radius: 12px 12px 0 12px; max-width: 70%; font-weight: 500;">
                                ${msg.text.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div style="display: flex; justify-content: flex-start;">
                            <div style="background: #0a0e27; border: 2px solid #00d4ff; color: #fff; padding: 12px 16px; border-radius: 12px 12px 12px 0; max-width: 70%; line-height: 1.6;">
                                ${msg.text.replace(/\n/g, '<br>')}
                            </div>
                        </div>
                    `;
                }
            }).join('');
            
            // Scroll to bottom
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }
        
        async function sendAIMessage() {
            const input = document.getElementById('ai-chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            userData.aiChatHistory.push({ type: 'user', text: message, timestamp: Date.now() });
            input.value = '';
            displayChatHistory();
            
            // Generate AI response
            setTimeout(() => {
                const aiResponse = generateAIResponse(message);
                addAIMessage(aiResponse);
            }, 500);
        }
        
        function addAIMessage(text) {
            userData.aiChatHistory.push({ type: 'ai', text, timestamp: Date.now() });
            displayChatHistory();
            saveUserData();
        }
        
        function generateAIResponse(userMessage) {
            const q = userMessage.toLowerCase();
            const age = userData.settings?.age || 0;
            const weight = userData.settings?.weight || 0;
            const goal = userData.settings?.goal || '';
            
            // Protein haqida
            if (q.includes('protein') || q.includes('protin')) {
                if (age < 18) {
                    return `üö® MUHIM OGOHLANTIRISH!\n\nSizning yoshingiz ${age}. 18 yoshgacha protein supplement tavsiya etilmaydi!\n\n‚úÖ Tabiiy protein manbalaridan foydalaning:\n‚Ä¢ ü•ö Tuxum (6-8 dona/kun)\n‚Ä¢ ü•© Go'sht (tovuq, mol)\n‚Ä¢ üêü Baliq\n‚Ä¢ ü•õ Sut mahsulotlari\n‚Ä¢ ü´ò Loviya, no'xat\n\nSizning yoshingizda tabiiy ovqatlanish yetarli. Supplement kerak emas!`;
                }
                return `üí™ PROTEIN HAQIDA MA'LUMOT\n\nSizning vazningiz: ${weight}kg\nKunlik protein: ${weight * 2}g (har kg uchun 2g)\n\nü•§ Protein Shake:\n‚Ä¢ Mashqdan keyin 30 daqiqa ichida\n‚Ä¢ 1 porsiya = 25-30g protein\n‚Ä¢ Suv yoki sut bilan aralashtiring\n\n‚è∞ Qabul vaqti:\n‚Ä¢ Ertalab: 1 porsiya\n‚Ä¢ Mashqdan keyin: 1 porsiya\n‚Ä¢ Uxlashdan oldin: 1 porsiya (agar kerak bo'lsa)\n\nüè∑Ô∏è Yaxshi brendlar:\n‚Ä¢ Optimum Nutrition Gold Standard\n‚Ä¢ MyProtein Impact Whey\n‚Ä¢ Dymatize ISO 100\n\nüí° Maslahat: Protein yetarli bo'lsa, mushak o'sadi!`;
            }
            
            // Kreatin haqida
            if (q.includes('creatine') || q.includes('kreatin') || q.includes('kreatine')) {
                if (age < 18) {
                    return `üö® MUHIM OGOHLANTIRISH!\n\nSizning yoshingiz ${age}. 18 yoshgacha kreatin tavsiya etilmaydi!\n\nKreatin kuchli supplement. Faqat 18+ yoshdagilarga tavsiya etiladi.\n\n‚úÖ Sizning yoshingizda:\n‚Ä¢ To'g'ri ovqatlanish\n‚Ä¢ Muntazam mashq\n‚Ä¢ Yetarli uyqu\n\nBu yetarli! Supplement kerak emas.`;
                }
                return `‚ö° KREATIN HAQIDA MA'LUMOT\n\nKreatin - eng samarali supplement!\n\nüìä Foydalari:\n‚Ä¢ Kuch 10-15% oshadi\n‚Ä¢ Mushak hajmi oshadi\n‚Ä¢ Tezroq tiklanish\n‚Ä¢ Energiya oshadi\n\nüíä Qabul qilish:\n‚Ä¢ Kuniga 5g (1 choy qoshiq)\n‚Ä¢ Har kuni bir xil vaqtda\n‚Ä¢ Suv bilan (250ml)\n‚Ä¢ Loading phase kerak emas!\n\n‚è∞ Qachon ichish:\n‚Ä¢ Mashqdan oldin yoki keyin\n‚Ä¢ Yoki istalgan vaqtda\n‚Ä¢ Muhimi - har kuni!\n\nüíß Suv:\n‚Ä¢ Kreatin suv ushlab qoladi\n‚Ä¢ Kuniga 3-4 litr suv iching!\n\nüè∑Ô∏è Yaxshi brendlar:\n‚Ä¢ Optimum Nutrition Micronized Creatine\n‚Ä¢ MyProtein Creatine Monohydrate\n‚Ä¢ Universal Nutrition Creatine\n\n‚úÖ Xavfsiz va samarali!`;
            }
            
            // BCAA haqida
            if (q.includes('bcaa') || q.includes('amino')) {
                return `üß™ BCAA HAQIDA MA'LUMOT\n\nBCAA = Branched-Chain Amino Acids\n(Leucine, Isoleucine, Valine)\n\nüìä Foydalari:\n‚Ä¢ Mushak parchalanishini kamaytiradi\n‚Ä¢ Tezroq tiklanish\n‚Ä¢ Charchoqni kamaytiradi\n‚Ä¢ Mashq davomida energiya\n\nüíä Qabul qilish:\n‚Ä¢ 5-10g har mashqda\n‚Ä¢ Mashq davomida yoki keyin\n‚Ä¢ Suv bilan aralashtiring\n\n‚è∞ Qachon kerak:\n‚Ä¢ Uzoq mashqlar (1+ soat)\n‚Ä¢ Och qoringa mashq\n‚Ä¢ Kaloriya defitsitida\n\nüí° Maslahat:\nAgar protein yetarli bo'lsa, BCAA shart emas. Lekin foydali!`;
            }
            
            // Vazn yo'qotish
            if (q.includes('oz') || q.includes('yo\'qot') || q.includes('yoqot') || q.includes('slim')) {
                return `üî• VAZN YO'QOTISH STRATEGIYASI\n\nSizning vazningiz: ${weight}kg\n\nüìâ Kaloriya:\n‚Ä¢ Kunlik: ${weight * 25}kcal (defitsit)\n‚Ä¢ Protein: ${weight * 2}g\n‚Ä¢ Uglevod: ${weight * 2}g\n‚Ä¢ Yog': ${weight * 0.8}g\n\nüèÉ Mashq:\n‚Ä¢ Kardio: 45-60 daqiqa, 5 kun/hafta\n‚Ä¢ Kuch: 30-40 daqiqa, 3 kun/hafta\n‚Ä¢ HIIT: 20 daqiqa, 2 kun/hafta\n\nü•ó Ovqatlanish:\n‚Ä¢ 5-6 marta kichik porsiya\n‚Ä¢ Ko'p sabzavot\n‚Ä¢ Kam uglevod (kechqurun)\n‚Ä¢ Yog'li ovqat YO'Q\n\nüíß Suv: 3 litr/kun\nüò¥ Uyqu: 7-8 soat\n\n‚ö†Ô∏è Qilmang:\n‚Ä¢ Och qolish\n‚Ä¢ Faqat kardio\n‚Ä¢ Tez yo'qotish (haftada 1kg dan ko'p)\n\n‚úÖ Sabr qiling! Natija 2-3 haftada ko'rinadi.`;
            }
            
            // Vazn oshirish
            if (q.includes('semir') || q.includes('oshir') || q.includes('gain')) {
                return `üí™ VAZN OSHIRISH STRATEGIYASI\n\nSizning vazningiz: ${weight}kg\n\nüìà Kaloriya:\n‚Ä¢ Kunlik: ${weight * 40}kcal (ortiqcha)\n‚Ä¢ Protein: ${weight * 2.5}g\n‚Ä¢ Uglevod: ${weight * 5}g\n‚Ä¢ Yog': ${weight * 1.2}g\n\nüèãÔ∏è Mashq:\n‚Ä¢ Og'ir vazn: 4-5 kun/hafta\n‚Ä¢ 8-12 takror, 3-4 set\n‚Ä¢ Compound exercises\n‚Ä¢ Kardio minimal (haftada 1-2 kun)\n\nüçΩÔ∏è Ovqatlanish:\n‚Ä¢ 6-7 marta/kun\n‚Ä¢ Har 2-3 soatda\n‚Ä¢ Ko'p uglevod\n‚Ä¢ Yog'li ovqatdan qo'rqmang!\n\nü•§ Ichimliklar:\n‚Ä¢ Protein shake: 2-3 marta/kun\n‚Ä¢ Sut: 1 litr/kun\n‚Ä¢ Mass gainer (agar kerak bo'lsa)\n\nüò¥ Uyqu: 8-9 soat (mushak uyquda o'sadi!)\n\n‚úÖ Sabr qiling! Oyiga 2-3kg sog'lom oshirish.`;
            }
            
            // Mushak qurish
            if (q.includes('mushak') || q.includes('muscle') || q.includes('bodybuilding')) {
                return `üèÜ MUSHAK QURISH DASTURI\n\nüí™ Mashq rejasi:\n\nüìÖ PUSH (Ko'krak, Yelka, Triceps):\n‚Ä¢ Bench Press: 4x8-10\n‚Ä¢ Incline Press: 3x10-12\n‚Ä¢ Shoulder Press: 4x8-10\n‚Ä¢ Lateral Raise: 3x12-15\n‚Ä¢ Triceps Pushdown: 3x12-15\n\nüìÖ PULL (Orqa, Biceps):\n‚Ä¢ Deadlift: 4x6-8\n‚Ä¢ Pull-ups: 4x8-12\n‚Ä¢ Barbell Row: 4x8-10\n‚Ä¢ Face Pull: 3x15-20\n‚Ä¢ Biceps Curl: 3x10-12\n\nüìÖ LEGS (Oyoqlar):\n‚Ä¢ Squat: 4x8-10\n‚Ä¢ Leg Press: 3x12-15\n‚Ä¢ Leg Curl: 3x12-15\n‚Ä¢ Calf Raise: 4x15-20\n\nüçΩÔ∏è Ovqatlanish:\n‚Ä¢ Protein: ${weight * 2.5}g/kun\n‚Ä¢ Kaloriya: ${weight * 40}kcal/kun\n‚Ä¢ Mashqdan keyin: Protein + Uglevod\n\nüíä Supplements:\n‚Ä¢ Protein shake\n‚Ä¢ Creatine 5g/kun\n‚Ä¢ Multivitamin\n\nüò¥ Dam olish:\n‚Ä¢ Har mushak 48 soat dam\n‚Ä¢ 8-9 soat uyqu\n\n‚úÖ 3-6 oyda natija ko'rinadi!`;
            }
            
            // Uyqu haqida
            if (q.includes('uyqu') || q.includes('sleep') || q.includes('dam')) {
                return `üò¥ UYQU VA TIKLANISH\n\nUyqu - mushak o'sishining 50%!\n\n‚è∞ Qancha uxlash kerak:\n‚Ä¢ Mushak qurish: 8-9 soat\n‚Ä¢ Vazn yo'qotish: 7-8 soat\n‚Ä¢ Umumiy: 7-8 soat\n\n‚úÖ Yaxshi uyqu uchun:\n‚Ä¢ Har kuni bir xil vaqtda uxlang\n‚Ä¢ Xonani qorong'i qiling\n‚Ä¢ Telefon YO'Q (1 soat oldin)\n‚Ä¢ Sovuqroq xona (18-20¬∞C)\n‚Ä¢ Kechki ovqat - 2-3 soat oldin\n\nüíä Uyquni yaxshilash:\n‚Ä¢ Magnesium\n‚Ä¢ Melatonin (agar kerak bo'lsa)\n‚Ä¢ Chamomile choy\n\n‚ö†Ô∏è Kam uyqu:\n‚Ä¢ Mushak o'smaydi\n‚Ä¢ Yog' to'planadi\n‚Ä¢ Kuch kamayadi\n‚Ä¢ Ishtaha oshadi\n\n‚úÖ Uyqu = Natija!`;
            }
            
            // Ovqatlanish haqida
            if (q.includes('ovqat') || q.includes('food') || q.includes('diet') || q.includes('kaloriya')) {
                return `üçΩÔ∏è OVQATLANISH REJASI\n\nSizning vazningiz: ${weight}kg\nMaqsad: ${goal}\n\nüìä Kunlik kaloriya:\n‚Ä¢ Vazn yo'qotish: ${weight * 25}kcal\n‚Ä¢ Saqlash: ${weight * 30}kcal\n‚Ä¢ Oshirish: ${weight * 40}kcal\n\nü•© Protein (${weight * 2}g/kun):\n‚Ä¢ Tovuq go'shti\n‚Ä¢ Tuxum\n‚Ä¢ Baliq\n‚Ä¢ Protein shake\n\nüçö Uglevod:\n‚Ä¢ Guruch\n‚Ä¢ Kartoshka\n‚Ä¢ Makaron\n‚Ä¢ Non (kam)\n\nü•ë Yog':\n‚Ä¢ Yong'oq\n‚Ä¢ Avokado\n‚Ä¢ Baliq yog'i\n‚Ä¢ Zaytun moyi\n\nü•ó Sabzavot:\n‚Ä¢ Ko'p sabzavot!\n‚Ä¢ Har ovqatda\n‚Ä¢ Turli rangda\n\n‚è∞ Ovqatlanish vaqti:\n‚Ä¢ 5-6 marta/kun\n‚Ä¢ Har 2-3 soatda\n‚Ä¢ Mashqdan oldin: Uglevod\n‚Ä¢ Mashqdan keyin: Protein + Uglevod\n\nüí° Maslahat: Ovqatni tarozida tortib o'lchang!`;
            }
            
            // Default response
            return `ü§ñ Savolingizni tushundim!\n\nMen quyidagi mavzularda yordam bera olaman:\n\nüí™ Mashq rejasi - "mashq rejasi" deb yozing\nüçΩÔ∏è Ovqatlanish - "ovqatlanish" deb yozing\nüíä Protein - "protein" deb yozing\n‚ö° Kreatin - "kreatin" deb yozing\nüß™ BCAA - "bcaa" deb yozing\nüìâ Vazn yo'qotish - "vazn yo'qotish" deb yozing\nüìà Vazn oshirish - "vazn oshirish" deb yozing\nüèÜ Mushak qurish - "mushak qurish" deb yozing\nüò¥ Uyqu - "uyqu" deb yozing\n\nBoshqa savol bo'lsa, so'rang!`;
        }
    </script>
</body>
</html>
